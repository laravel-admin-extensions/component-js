const _component={trash:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">\n  <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>\n  <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>\n</svg>',move:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrows-move" viewBox="0 0 16 16">\n  <path fill-rule="evenodd" d="M7.646.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 1.707V5.5a.5.5 0 0 1-1 0V1.707L6.354 2.854a.5.5 0 1 1-.708-.708l2-2zM8 10a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 14.293V10.5A.5.5 0 0 1 8 10zM.146 8.354a.5.5 0 0 1 0-.708l2-2a.5.5 0 1 1 .708.708L1.707 7.5H5.5a.5.5 0 0 1 0 1H1.707l1.147 1.146a.5.5 0 0 1-.708.708l-2-2zM10 8a.5.5 0 0 1 .5-.5h3.793l-1.147-1.146a.5.5 0 0 1 .708-.708l2 2a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708-.708L14.293 8.5H10.5A.5.5 0 0 1 10 8z"/>\n</svg>',write:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">\n  <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>\n  <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>\n</svg>',close:'<svg style="vertical-align: middle;" width="14" height="14" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill="none" stroke="white" stroke-width="2.5" d="M16,16 L4,4"></path><path fill="none" stroke="white" stroke-width="2.5" d="M16,4 L4,16"></path></svg>',loading:'<svg version="1.1" style=\'width: 100%;height:100px\' xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\nwidth="40px" height="40px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve">\n<path opacity="0.2" fill="#000" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946\ns14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634\nc0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z"/>\n<path fill="#000" d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0\nC22.32,8.481,24.301,9.057,26.013,10.047z"><animateTransform attributeType="xml"attributeName="transform"\ntype="rotate"from="0 20 20"to="360 20 20"dur="0.5s"repeatCount="indefinite"/></path></svg>',check:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">\n  <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>\n</svg>',check_circle:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16">\n  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>\n  <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>\n</svg>',request:function(e,t="GET",i={},s=null){let a=new XMLHttpRequest;a.open(t,e,!0),a.timeout=3e4;let n="";document.querySelector('meta[name="csrf-token"]')&&(n=document.querySelector('meta[name="csrf-token"]').getAttribute("content")),a.setRequestHeader("X-CSRF-TOKEN",n),"GET"===t?(a.setRequestHeader("Content-type","application/text;charset=UTF-8"),a.responseType="text",a.send(null)):(a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.responseType="json",a.send(i)),a.onreadystatechange=function(){if(a.readyState===a.DONE&&200===a.status){let e=a.response;"function"==typeof s&&s(e)}},a.onerror=function(e){console.error(e)}},alert:function(e,t=1,i=null){let s=document.createElement("div");s.innerHTML=e;let a=window.innerWidth/2-140,n=window.innerHeight/2-145;s.style="z-index: 1000000; position: fixed;background-color: rgba(0,0,0,.6);color: #fff;width: 280px;height: 45px;line-height: 40px;border-radius: 3px;text-align: center;top:"+n+"px;left:"+a+"px;",document.getElementsByTagName("BODY")[0].appendChild(s);var l=setTimeout((function(){clearTimeout(l),s.parentNode.removeChild(s),"function"==typeof i&&i()}),1e3*t)},contextmenu:function(e,t,i={}){i=Object.assign({W:"70px"},i);let s=document.createElement("ul");s.className="dlp dlp-contextmenu";for(let e in t){let a=document.createElement("li");a.className="dlp dlp-text",a.textContent=e,a.style.width=i.W,"function"==typeof t[e]&&(a.addEventListener("click",(()=>{t[e](),s.remove()})),s.append(a))}s.style=`top: ${e.pageY-3}px;left: ${e.pageX-3}px;`,s.addEventListener("mouseleave",(()=>{s.remove()})),document.getElementsByTagName("BODY")[0].appendChild(s)}};class ComponentDot{MODE={insert:"insert",delete:"delete"};constructor(e,t,i){if(this.name=e,this.DOM=document.getElementById(e),this.DOM.addEventListener("contextmenu",(e=>{e.preventDefault()})),!Array.isArray(t))return void console.error("Dot param selected must be array!");if(Array.isArray(i)||"object"!=typeof i)return void console.error("Dot param select must be object such as {key:val,key2:val2,...} !");this.make(t,i),this.selected_data=t,this.select_data=t.slice(0),this.insert_data=[],this.delete_data=[];for(let e of this.SELECTED_DOM.getElementsByClassName("dlp-label"))e.addEventListener("click",this.tagCancel.bind(this,e),!1);for(let e of this.CONTENT_DOM.getElementsByClassName("dlp-label"))e.addEventListener("click",this.tagSelect.bind(this,e),!1);let s=document.querySelector(`#${this.name} .dot-search`),a=this;s.addEventListener("input",(()=>{let e=setTimeout((function(){clearTimeout(e),a.search(s)}),500)}))}make(e,t){let i="",s="";for(let a in t)-1===e.indexOf(parseInt(a))?s+=`<div class='dlp dlp-text dlp-label' data-id='${a}' title="${t[a]}">${t[a]}</div>`:i+=`<div class='dlp dlp-text dlp-label' data-id='${a}' title="${t[a]}">${t[a]}</div>`;let a=`<div class="dlp-dot" ><div class="dot-top"><input type="text" class="dlp dot-search" placeholder="搜索名称"><div class="dot-selected dlp-scroll">${i}</div></div><div class="dot-body"><div class="dot-select dlp-scroll">${s}</div></div></div>\n<input name="${this.name}[select]" value='${JSON.stringify(e)}' type="hidden"><input name="${this.name}[insert]" value="[]" type="hidden"><input name="${this.name}[delete]" value="[]" type="hidden">`;this.DOM.insertAdjacentHTML("afterbegin",a),this.SELECTED_DOM=document.querySelector(`#${this.name} .dot-selected`),this.CONTENT_DOM=document.querySelector(`#${this.name} .dot-select`),this.selectInputDOM=document.querySelector(`input[name='${this.name}[select]']`),this.insertInputDOM=document.querySelector(`input[name='${this.name}[insert]']`),this.deleteInputDOM=document.querySelector(`input[name='${this.name}[delete]']`)}tagSelect(e){e.addEventListener("click",this.tagCancel.bind(this,e),!1),this.SELECTED_DOM.appendChild(e),this.tagCal(e,this.MODE.insert),this.SELECTED_DOM.scrollTop=this.SELECTED_DOM.scrollHeight}tagCancel(e){e.addEventListener("click",this.tagSelect.bind(this,e),!1),this.CONTENT_DOM.appendChild(e),this.tagCal(e,this.MODE.delete)}tagCal(e,t){let i=parseInt(e.getAttribute("data-id"));if(t!==this.MODE.insert){if(t===this.MODE.delete){let e=this.select_data.indexOf(i);-1!==e&&(this.select_data.splice(e,1),this.selectInputDOM.value=JSON.stringify(this.select_data)),-1!==this.selected_data.indexOf(i)&&-1===this.delete_data.indexOf(i)&&(this.delete_data.push(i),this.deleteInputDOM.value=JSON.stringify(this.delete_data)),e=this.insert_data.indexOf(i),-1!==e&&(this.insert_data.splice(e,1),this.insertInputDOM.value=JSON.stringify(this.insert_data))}}else{-1===this.select_data.indexOf(i)&&(this.select_data.push(i),this.selectInputDOM.value=JSON.stringify(this.select_data)),-1===this.selected_data.indexOf(i)&&-1===this.insert_data.indexOf(i)&&(this.insert_data.push(i),this.insertInputDOM.value=JSON.stringify(this.insert_data));let e=this.delete_data.indexOf(i);-1!==e&&(this.delete_data.splice(e,1),this.deleteInputDOM.value=JSON.stringify(this.delete_data))}}search(e){if(""===e.value){if(this.SELECT_COVER_DOM instanceof HTMLElement){let e=[];this.SELECT_COVER_DOM.childNodes.forEach((t=>{e.push(t)})),this.CONTENT_DOM.append(...e),this.SELECT_COVER_DOM.remove(),this.SELECT_COVER_DOM=null}return}if(this.SELECT_COVER_DOM instanceof HTMLElement){let e=[];this.SELECT_COVER_DOM.childNodes.forEach((t=>{e.push(t)})),this.CONTENT_DOM.append(...e)}else this.SELECT_COVER_DOM=document.createElement("div"),this.SELECT_COVER_DOM.className="dot-select dlp-scroll dot-select-cover",this.CONTENT_DOM.parentNode.appendChild(this.SELECT_COVER_DOM);let t=[];for(let i of this.CONTENT_DOM.childNodes)-1!==i.className.indexOf("dlp-label")&&-1!==i.innerText.indexOf(e.value)&&t.push(i);this.SELECT_COVER_DOM.append(...t)}}class ComponentCascadeDot{MODE={insert:"insert",delete:"delete"};constructor(e,t,i){if(this.name=e,this.DOM=document.getElementById(e),!Array.isArray(t)||!Array.isArray(i))return void console.error("CascadeDot param selected and select must be array!");this.selected_data=t,this.select_data=t.slice(0),this.insert_data=[],this.delete_data=[],this.make().makeSelect(i),this.selectInputDOM.value=JSON.stringify(this.select_data);let s=document.querySelector(`#${this.name} .dot-search`),a=this;s.addEventListener("input",(()=>{let e=setTimeout((function(){clearTimeout(e),a.search(s)}),500)}))}make(){let e=`<div class="dlp-dot" ><div class="dot-top"><input type="text" class="dlp dot-search" placeholder="搜索名称"><div id="${this.name}-select" class="dot-selected dlp-scroll"></div></div><div class="dot-body"><div class="dot-select dot-select-cascade dlp-scroll"></div></div></div>\n<input name="${this.name}[select]" value="[]" type="hidden"><input name="${this.name}[insert]" value="[]" type="hidden"><input name="${this.name}[delete]" value="[]" type="hidden">`;return this.DOM.insertAdjacentHTML("afterbegin",e),this.DOM.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.SELECTED_DOM=document.querySelector(`#${this.name} .dot-selected`),this.CONTENT_DOM=document.querySelector(`#${this.name} .dot-select`),this.selectInputDOM=document.querySelector(`input[name='${this.name}[select]']`),this.insertInputDOM=document.querySelector(`input[name='${this.name}[insert]']`),this.deleteInputDOM=document.querySelector(`input[name='${this.name}[delete]']`),this}makeSelect(e){this.dimensional_data=[],this.makeDimensional(e);let t=this;for(let e in this.dimensional_data){e=parseInt(e);let i=this.dimensional_data[e],s=document.createElement("div");s.className="dot-cascade-stack dlp-scroll",i.forEach(((i,a)=>{Array.isArray(i.nodes)&&0!==i.nodes.length?(i.nodes=i.nodes.map((e=>e.key)),i.checkAll=!1):(i.nodes=null,i.checked=!1);let n=document.createElement("div");n.className="dlp dlp-text dlp-label",n.textContent=i.val,n.setAttribute("data-id",i.key),n.setAttribute("data-k",a),n.addEventListener("click",this.select.bind(this,n,e)),null!==i.nodes?n.addEventListener("contextmenu",(s=>{s.preventDefault(),_component.contextmenu(s,{"全选":()=>{let s=parseInt(n.getAttribute("data-k"));t.checkAll(e+1,this.dimensional_data[e][s].nodes,i.checkAll),!0===i.checkAll?i.checkAll=!1:i.checkAll=!0}})})):n.addEventListener("contextmenu",(e=>{e.preventDefault()})),s.append(n);let l=this.selected_data.indexOf(parseInt(i.key));if(!1!==i.checked&&-1!==l)return this.selected_data.splice(l,1),void(this.select_data=this.selected_data.slice(0));if(-1!==l){i.checked=!0;let e=new Event("click");setTimeout((()=>{n.click(),n.dispatchEvent(e)}))}})),this.CONTENT_DOM.append(s)}return this.STACKS=this.CONTENT_DOM.childNodes,this}makeDimensional(e,t=0,i=[]){if(Array.isArray(e)){for(let s in e){let a=i.slice(0);a.push(e[s].key),this.makeDimensional(e[s],t,a)}return}let s=i.slice(0);s.pop(),e.parentNodes=s,Array.isArray(this.dimensional_data[t])?this.dimensional_data[t].push(e):this.dimensional_data[t]=[e],e.hasOwnProperty("nodes")&&Array.isArray(e.nodes)&&0!==e.nodes.length&&(t++,this.makeDimensional(e.nodes,t,i))}select(e,t){let i=parseInt(e.getAttribute("data-id")),s=parseInt(e.getAttribute("data-k")),a=this.dimensional_data[t][s],n=this.STACKS[t].childNodes,l=a.parentNodes[a.parentNodes.length-1];if(!1===a.checked)a.checked=!0,n.forEach(((e,i)=>{-1!==this.dimensional_data[t][i].parentNodes.indexOf(l)?n[i].classList.remove("dlp-label-silence"):n[i].classList.add("dlp-label-silence")})),this.tagCal(i,this.MODE.insert),e.classList.remove("dlp-label-silence"),null!=e.querySelector("i")&&e.removeChild(e.querySelector("i")),e.insertAdjacentHTML("beforeend",`<i>${_component.check}</i>`),this.selectToChildren(t+1,a.nodes),this.selectToSelected(e,t),this.SELECTED_DOM.scrollTop=this.SELECTED_DOM.scrollHeight;else if(!0===a.checked){a.checked=!1,this.tagCal(i,this.MODE.delete),null!=e.querySelector("i")&&e.removeChild(e.querySelector("i"));for(let e of this.SELECTED_DOM.childNodes)if(parseInt(e.getAttribute("data-id"))===i){e.remove();break}}else n.forEach(((e,i)=>{-1!==this.dimensional_data[t][i].parentNodes.indexOf(l)?n[i].classList.remove("dlp-label-silence"):n[i].classList.add("dlp-label-silence")})),e.classList.remove("dlp-label-silence"),this.selectToChildren(t+1,a.nodes);if(Array.isArray(a.parentNodes)&&a.parentNodes.length>0){let e=a.parentNodes.slice(0);this.selectToParent(e,a.checked)}}selectToSelected(e,t){let i=document.createElement("div");i.className="dlp dlp-text dlp-label",i.setAttribute("data-id",e.getAttribute("data-id")),i.setAttribute("stack",t),i.textContent=e.textContent;var s=this;i.addEventListener("click",(function(){s.select(e,t)})),this.SELECTED_DOM.append(i)}selectToParent(e,t){let i=e.length-1,s=e.pop(),a=e[i-1],n=this.STACKS[i].childNodes,l=null;n.forEach(((e,d)=>{let r=this.dimensional_data[i][d],o=r.parentNodes;if(!0===t||void 0===t){let e=n[d];o.length>0&&o[i-1]!==a||0===o.length&&parseInt(e.getAttribute("data-id"))!==s?e.classList.add("dlp-label-silence"):(e.classList.remove("dlp-label-silence"),null===l&&parseInt(e.getAttribute("data-id"))===s&&(l=d))}if(!0===t&&s===r.key&&!0!==r.mark&&(r.mark=!0,e.insertAdjacentHTML("beforeend",`<i>${_component.check_circle}</i>`)),!1===t&&s===r.key){let t=this.dimensional_data[i][d].nodes,s=!0;for(let e of this.dimensional_data[i+1])if(-1!==t.indexOf(e.key)&&(!0===e.checked||!0===e.mark)){s=!1;break}s&&e.querySelector("i")instanceof HTMLElement&&(r.mark=!1,e.querySelector("i").remove())}})),null!==l&&(this.STACKS[i].scrollTop=27*l),e.length>0&&this.selectToParent(e,t)}selectToChildren(e,t){if(e>this.dimensional_data.length-1)return;let i=this.STACKS[e].childNodes,s=[],a=null;i.forEach(((i,n)=>{if(null!==t)if(-1!==t.indexOf(parseInt(i.getAttribute("data-id")))){i.classList.remove("dlp-label-silence");let t=this.dimensional_data[e][n].nodes;Array.isArray(t)&&t.forEach((e=>{-1===s.indexOf(t)&&s.push(e)})),null===a&&(a=n)}else i.classList.add("dlp-label-silence");else i.classList.add("dlp-label-silence")})),null!==a&&(this.STACKS[e].scrollTop=27*a),this.selectToChildren(e+1,s)}tagCal(e,t){if(t!==this.MODE.insert){if(t===this.MODE.delete){let t=this.select_data.indexOf(e);-1!==t&&(this.select_data.splice(t,1),this.selectInputDOM.value=JSON.stringify(this.select_data)),-1!==this.selected_data.indexOf(e)&&-1===this.delete_data.indexOf(e)&&(this.delete_data.push(e),this.deleteInputDOM.value=JSON.stringify(this.delete_data)),t=this.insert_data.indexOf(e),-1!==t&&(this.insert_data.splice(t,1),this.insertInputDOM.value=JSON.stringify(this.insert_data))}}else{-1===this.select_data.indexOf(e)&&(this.select_data.push(e),this.selectInputDOM.value=JSON.stringify(this.select_data)),-1===this.selected_data.indexOf(e)&&-1===this.insert_data.indexOf(e)&&(this.insert_data.push(e),this.insertInputDOM.value=JSON.stringify(this.insert_data));let t=this.delete_data.indexOf(e);-1!==t&&(this.delete_data.splice(t,1),this.deleteInputDOM.value=JSON.stringify(this.delete_data))}}search(e){if(""!==e.value){if(!(this.SELECT_COVER_DOM instanceof HTMLElement)){this.COVER_STACK_HASH_DOM=[],this.SELECT_COVER_DOM=document.createElement("div"),this.SELECT_COVER_DOM.className="dot-select-cover dlp-scroll dot-select-cascade";for(let e=1;e<=this.dimensional_data.length;e++){let e=document.createElement("div");e.className="dot-cascade-stack dlp-scroll",this.SELECT_COVER_DOM.append(e)}this.CONTENT_DOM.parentNode.append(this.SELECT_COVER_DOM)}this.dimensional_data.forEach(((t,i)=>{t.forEach(((t,s)=>{if(-1!==t.val.indexOf(e.value)&&(!Array.isArray(this.COVER_STACK_HASH_DOM[i])||-1===this.COVER_STACK_HASH_DOM[i].indexOf(t.key))){let e=document.createElement("div");if(e.className="dlp dlp-text dlp-label",e.textContent=t.val,e.addEventListener("click",(()=>this.searchCoverClick(i,t,this.STACKS[i].childNodes[s]))),this.SELECT_COVER_DOM.childNodes[i].appendChild(e),!Array.isArray(this.COVER_STACK_HASH_DOM[i]))return void(this.COVER_STACK_HASH_DOM[i]=[t.key]);this.COVER_STACK_HASH_DOM[i].push(t.key)}}))}))}else this.SELECT_COVER_DOM instanceof HTMLElement&&(this.SELECT_COVER_DOM.remove(),this.SELECT_COVER_DOM=null,this.COVER_STACK_HASH_DOM=[])}searchCoverClick(e,t,i){if(null===t.nodes)i instanceof HTMLElement&&i.click();else{let i=e+1;this.dimensional_data[i].forEach(((e,s)=>{if(-1!==t.nodes.indexOf(e.key)&&(!Array.isArray(this.COVER_STACK_HASH_DOM[i])||-1===this.COVER_STACK_HASH_DOM[i].indexOf(e.key))){let t=document.createElement("div");if(t.className="dlp dlp-text dlp-label",t.textContent=e.val,t.addEventListener("click",(()=>this.searchCoverClick(i,e,this.STACKS[i].childNodes[s]))),this.SELECT_COVER_DOM.childNodes[i].appendChild(t),!Array.isArray(this.COVER_STACK_HASH_DOM[i]))return void(this.COVER_STACK_HASH_DOM[i]=[e.key]);this.COVER_STACK_HASH_DOM[i].push(e.key)}}))}}checkAll(e,t,i){if(e>this.dimensional_data.length-1)return;if(!Array.isArray(t)||t.length<=0)return;let s=this.STACKS[e].childNodes,a=[],n=null;s.forEach(((s,l)=>{if(-1!==t.indexOf(parseInt(s.getAttribute("data-id")))){let t=this.dimensional_data[e][l].checked;!1===i?(!1===t&&s.click(),this.dimensional_data[e][l].checkAll=!0):!0===i&&(!0===t&&s.click(),this.dimensional_data[e][l].checkAll=!1);let d=this.dimensional_data[e][l].nodes;Array.isArray(d)&&d.forEach((e=>{-1===a.indexOf(d)&&a.push(e)})),null===n&&(n=l)}})),null!==n&&(this.STACKS[e].scrollTop=27*n),this.checkAll(e+1,a,i)}}class ComponentLine{constructor(e,t,i,s={}){this.DOM=document.getElementById(e),this.DOM.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.COLUMNS=t,this.DATA=i,this.OPTIONS=Object.assign({sortable:!0,delete:!0},s);let a=this.makeHead();this.DATA_INPUT=document.createElement("input"),this.DATA_INPUT.setAttribute("name",e),this.DATA_INPUT.setAttribute("type","hidden"),this.DATA_INPUT.value="[]",this.DOM.appendChild(this.DATA_INPUT),this.makeBody(),this.makeFoot(a),this.OPTIONS.sortable&&this.sortable()}makeHead(){let e="<tr>",t=e,i=this.COLUMNS;for(let s in i)"hidden"!==i[s].type&&(i[s].style?(e+=`<th style="${i[s].style}">${i[s].name}</th>`,t+=`<th style="${i[s].style}"><input class="dlp-input" data-column="${s}" placeholder=":${i[s].name}"/></th>`):(e+="<th>"+i[s].name+"</th>",t+=`<th><input class="dlp-input" data-column="${s}" placeholder=":${i[s].name}"/></th>`));return e+='<th class="operate-column" style="width: 48px;"></th></tr>',t+='<th class="insert_handel operate-column" style="width: 48px;"></th></tr>',this.DOM.insertAdjacentHTML("afterbegin",`<table class="dlp dlp-table" style="height: 100%"><thead>${e}</thead></table>`),this.TABLE_DOM=this.DOM.getElementsByTagName("table")[0],t}makeBody(){var e=[],t=document.createElement("tbody"),i=this,s=this.COLUMNS;!1!==Array.isArray(this.DATA)&&(this.DATA.forEach((function(a,n){let l=document.createElement("tr");l.setAttribute("sortable-item","sortable-item");let d={};for(let e in s){if("hidden"===s[e].type){a[e]&&(d[e]=a[e]);continue}let t=document.createElement("td");a[e]?(d[e]=a[e],i.makeTd(t,s[e].type,a[e],e),s[e].style&&(t.style=s[e].style)):(d[e]="",i.makeTd(t,s[e].type,"",e),s[e].style&&(t.style=s[e].style)),l.setAttribute("data-key",n.toString()),l.appendChild(t)}let r=document.createElement("td");i.operateButton(r),l.appendChild(r),t.appendChild(l),e.push(d)})),i.DATA=e,i.DATA_INPUT.value=JSON.stringify(e),t.setAttribute("sortable-list","sortable-list"),t.className="dlp-scroll",this.TBODY_DOM=t,this.TABLE_DOM.appendChild(t))}makeFoot(e){let t=document.createElement("tfoot");t.insertAdjacentHTML("afterbegin",e),this.TABLE_DOM.appendChild(t);var i=this,s=document.createElement("i");s.style="cursor: pointer",s.insertAdjacentHTML("afterbegin",_component.write),s.addEventListener("click",(function(){let e=i.DOM.getElementsByTagName("tfoot")[0].getElementsByTagName("input"),t={},s=document.createElement("tr");s.setAttribute("sortable-item","sortable-item"),s.setAttribute("data-key",i.DATA.length.toString());for(let a in e)if(e.hasOwnProperty(a)){let n=document.createElement("td"),l=e[a].getAttribute("data-column");t[l]=e[a].value,i.makeTd(n,i.COLUMNS[l].type,e[a].value,l),i.COLUMNS[l].style&&(n.style=i.COLUMNS[l].style),s.appendChild(n),e[a].value=""}let a=document.createElement("td");i.operateButton(a),s.appendChild(a),i.TBODY_DOM.appendChild(s),i.DATA.push(t),i.DATA_INPUT.value=JSON.stringify(i.DATA),i.TBODY_DOM.scrollTop=i.TBODY_DOM.scrollHeight}),!1),this.DOM.getElementsByClassName("insert_handel")[0].appendChild(s)}makeTd(e,t,i,s,a){var n=this;switch(t){case"text":default:e.insertAdjacentHTML("afterbegin",`<p style="display: block;" class="dlp-text" title="${i}">${i}</p>`);break;case"input":let t=document.createElement("input");t.setAttribute("class","dlp-input"),t.setAttribute("data-column",s),t.value=i;for(let e in a)t.setAttribute(e,a[e]);t.addEventListener("input",(function(){let e=this.parentNode.parentNode.getAttribute("data-key"),t=this.getAttribute("data-column");n.DATA[e]&&(n.DATA[e][t]=this.value,n.DATA_INPUT.value=JSON.stringify(n.DATA))}),!1),e.appendChild(t)}}operateButton(e){var t=this;if(this.OPTIONS.sortable){let t=document.createElement("i");t.setAttribute("style","cursor: pointer;margin-right:5px;"),t.setAttribute("sortable-handle","sortable-handle"),t.insertAdjacentHTML("afterbegin",_component.move),e.appendChild(t)}if(this.OPTIONS.delete){let i=document.createElement("span");i.setAttribute("style","cursor: pointer;display: inline-block;"),i.insertAdjacentHTML("afterbegin",_component.trash),i.addEventListener("click",(function(){let e=this.parentNode.parentNode,i=e.parentNode,s=e.getAttribute("data-key");t.DATA.splice(s,1),i.removeChild(e),t.DATA_INPUT.value=JSON.stringify(t.DATA);for(let e in i.childNodes)i.childNodes[e]instanceof HTMLElement&&i.childNodes[e].setAttribute("data-key",e)}),!1),e.appendChild(i)}e.className="operate-column"}sortable(){var e=this;new ComponentSortable(this.TBODY_DOM,(function(t){let i=[];t.forEach((function(t){i.push(e.DATA[t])})),e.DATA=i,e.DATA_INPUT.value=JSON.stringify(e.DATA)}))}}class ComponentPlane{constructor(e,t="",i="POST",s=null,a={}){this.URL=e,this.XHR_URL=t,this.METHOD=i,this.CALLBACK=s,this.OPTIONS=Object.assign({W:.8,H:.8},a),this.makeModal(),this.makeContent()}makeModal(){let e=`<div id="dlp-plane" class="dlp-plane-gauze"><div style="width: ${window.innerWidth*this.OPTIONS.W}px;"><div class="dlp plane-header"></div><div class="plane-body dlp-scroll" style="max-height:${window.innerHeight*this.OPTIONS.H}px;min-height:${window.innerHeight*this.OPTIONS.H/2}px;"></div></div></div>`;document.body.insertAdjacentHTML("beforeEnd",e),this.DOM=document.getElementById("dlp-plane");let t=document.createElement("i");t.insertAdjacentHTML("afterbegin",_component.close);let i=this;t.addEventListener("click",(function(){i.DOM instanceof HTMLElement&&i.DOM.remove(),document.getElementById("kvFileinputModal")instanceof HTMLElement&&document.getElementById("kvFileinputModal").remove()}),!1),i.DOM.querySelector(".plane-header").append(t),this.MODEL_BODY_DOM=i.DOM.querySelector(".plane-body")}makeContent(){this.loading();let e=this;_component.request(this.URL,"GET",{},(function(t){e.loading(!0);let i=document.createRange().createContextualFragment(t);document.querySelector("#dlp-plane .plane-body").appendChild(i);let s=e.MODEL_BODY_DOM.querySelector('button[type="submit"]');s instanceof HTMLElement&&s.addEventListener("click",e.submitEvent.bind(e,s),!1)}))}submitEvent(e){e.setAttribute("disabled","disabled"),e.innerText="提交中...";let t=this.MODEL_BODY_DOM.getElementsByTagName("form")[0],i=new FormData(t),s=this;_component.request(this.XHR_URL,this.METHOD,i,(function(t){"function"!=typeof s.CALLBACK?0===t.code?window.location.reload():_component.alert(t.message,3,(function(){e.removeAttribute("disabled"),e.innerText="提交"})):s.CALLBACK(t)}))}loading(e=!1){if(e&&this.LOADING_DOM)return this.MODEL_BODY_DOM.removeChild(this.LOADING_DOM),void(this.LOADING_DOM=null);this.LOADING_DOM instanceof HTMLElement||(this.LOADING_DOM=document.createElement("div"),this.LOADING_DOM.style="width: 100%;height: 100px;",this.LOADING_DOM.insertAdjacentHTML("afterbegin",_component.loading),this.MODEL_BODY_DOM.append(this.LOADING_DOM))}}class ComponentSortable{constructor(e,t=null){this.list="string"==typeof e?document.querySelector(e):e,this.options={animationSpeed:200,animationEasing:"ease-out"},this.callback=t,this.animation=!1,this.dragStart=this.dragStart.bind(this),this.dragMove=this.dragMove.bind(this),this.dragEnd=this.dragEnd.bind(this),this.list.addEventListener("touchstart",this.dragStart,!1),this.list.addEventListener("mousedown",this.dragStart,!1)}reset(){this.items=Array.from(this.list.children),this.items[this.items.length-1].offsetTop>this.list.offsetHeight?this.listHeight=this.list.scrollHeight:this.listHeight=this.items[this.items.length-1].offsetTop}dragStart(e){if(this.reset(),this.animation)return;if(this.items.length<2)return;this.handle=null;let t=e.target;for(;t&&(t.hasAttribute("sortable-handle")&&(this.handle=t),t.hasAttribute("sortable-item")&&(this.item=t),!t.hasAttribute("sortable-list"));)t=t.parentElement;if(!this.handle)return;this.list.style.position="relative",this.item.classList.add("is-dragging"),this.itemHeight=this.items[1].offsetTop,this.startTouchY=this.getDragY(e),this.startTop=this.item.offsetTop;const i=this.items.map((e=>e.offsetTop));this.items.forEach(((e,t)=>{e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.transform=`translateY(${i[t]}px)`,e.style.zIndex=e===this.item?2:1})),this.positions=this.items.map(((e,t)=>t)),this.position=Math.round(this.startTop/this.listHeight*this.items.length),this.touch="touchstart"===e.type,window.addEventListener(this.touch?"touchmove":"mousemove",this.dragMove),window.addEventListener(this.touch?"touchend":"mouseup",this.dragEnd,!1)}dragMove(e){if(this.animation)return;if(this.items.length<2)return;const t=this.startTop+this.getDragY(e)-this.startTouchY,i=Math.round(t/this.listHeight*this.items.length);this.item.style.transform=`translateY(${t}px)`,this.positions.forEach((e=>{e!==this.position&&e===i&&(this.swapElements(this.positions,this.position,e),this.position=e)})),this.items.forEach(((e,t)=>{e!==this.item&&(e.style.transform=`translateY(${this.positions.indexOf(t)*this.itemHeight}px)`,e.style.transition=`transform ${this.options.animationSpeed}ms ${this.options.animationEasing}`)})),e.preventDefault()}dragEnd(e){this.animation=!0,this.items.length<2||(this.item.style.transition=`all ${this.options.animationSpeed}ms ${this.options.animationEasing}`,this.item.style.transform=`translateY(${this.position*this.itemHeight}px)`,this.item.classList.remove("is-dragging"),"function"==typeof this.callback&&this.callback(this.positions),setTimeout((()=>{this.list.style.position="",this.items.forEach((e=>{e.style.top="",e.style.left="",e.style.right="",e.style.position="",e.style.transform="",e.style.transition="",e.style.zIndex=""})),this.positions.map((e=>{this.items[e]&&this.list.appendChild(this.items[e])})),this.animation=!1}),this.options.animationSpeed),window.removeEventListener(this.touch?"touchmove":"mousemove",this.dragMove,{passive:!1}),window.removeEventListener(this.touch?"touchend":"mouseup",this.dragEnd,!1))}swapElements(e,t,i){const s=e[t];e[t]=e[i],e[i]=s}getDragY(e){return e.touches?(e.touches[0]||e.changedTouches[0]).pageY:e.pageY}}