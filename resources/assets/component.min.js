function _componentRequest(t,e="GET",i={},s=function(){}){var n=new XMLHttpRequest;n.open(e,t,!0),n.timeout=3e4;var a=document.querySelector('meta[name="csrf-token"]').getAttribute("content");n.setRequestHeader("X-CSRF-TOKEN",a),"GET"==e?(n.setRequestHeader("Content-type","application/text;charset=UTF-8"),n.responseType="text",n.send(null)):(n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.responseType="json",n.send(i)),n.onreadystatechange=function(){if(n.readyState==n.DONE&&200==n.status){var t=n.response;s(t)}},n.onerror=function(t){console.log(t)}}function _componentAlert(t,e=1,i=function(){}){let s=document.createElement("div");s.innerHTML=t;let n=window.innerWidth/2-140,a=window.innerHeight/2-145;s.style="z-index: 1000000; position: fixed;background-color: rgba(0,0,0,.6);color: #fff;width: 280px;height: 45px;line-height: 40px;border-radius: 3px;text-align: center;top:"+a+"px;left:"+n+"px;",document.getElementsByTagName("BODY")[0].appendChild(s);var l=setTimeout((function(){clearTimeout(l),s.parentNode.removeChild(s),i()}),1e3*e)}class ComponentDot{constructor(t,e,i){this.DOM=document.getElementById(t);let s="",n="";for(let t in i)e[t]?s+=`<div class='btn btn-success btn-sm v-tag' style='margin-right: 4px;margin-bottom: 4px' data-id='${t}'>${i[t]}</div>`:n+=`<div class='btn btn-primary btn-sm v-tag' style='margin-right: 4px;margin-bottom: 4px' data-id='${t}'>${i[t]}</div>`;this.selected_data=Object.keys(e),this.select_data=this.selected_data.map((t=>t));let a=JSON.stringify(this.select_data);this.insert_data=[],this.delete_data=[];let l=`<style>#${t}-select::-webkit-scrollbar,#${t}-content::-webkit-scrollbar{width: 4px;height: 4px;}\n#${t}-select::-webkit-scrollbar-thumb,#${t}-content::-webkit-scrollbar-thumb {border-radius: 5px;-webkit-box-shadow: inset 0 0 5px rgba(0,0,0,0.2);background: rgba(0,0,0,0.2);}\n#${t}-select::-webkit-scrollbar-track,#${t}-content::-webkit-scrollbar-track {-webkit-box-shadow: inset 0 0 5px rgba(0,0,0,0.2);border-radius: 0;background: rgba(0,0,0,0.1);}</style>\n<div style="width: 100%;height:100%;display: grid; grid-template-rows: 42px auto;border: 1px solid #ccc;border-radius: 5px">\n        <div style="display:flex;background: #e1ffa8bf;"><div style="width:120px;background: #e1ffa8bf;">\n        <input id="${t}-search" type="text" class="form-control" placeholder="搜索名称"></div>\n        <div id="${t}-select" style="width:100%;overflow: auto;border-bottom: 1px solid #ccc;padding: 3px;border-radius: 0 0 0 14px;background: #ffffffbf;">${s}</div>\n        </div><div id="${t}-content" style="overflow-y: auto;padding: 3px;background: #e1ffa8bf;">\n        ${n}</div></div>\n        <input name="${t}[data]" value='${a}' type="hidden">\n        <input name="${t}[insert]" value="[]" type="hidden">\n        <input name="${t}[delete]" value="[]" type="hidden">`;this.DOM.insertAdjacentHTML("afterbegin",l),this.SELECT_DOM=document.getElementById(t+"-select"),this.CONTENT_DOM=document.getElementById(t+"-content"),this.dataDOM=document.querySelector(`input[name='${t}[data]']`),this.insertDOM=document.querySelector(`input[name='${t}[insert]']`),this.deleteDOM=document.querySelector(`input[name='${t}[delete]']`);for(let e of document.getElementById(t+"-select").getElementsByClassName("v-tag"))e.addEventListener("click",this.tagCancel.bind(this,e),!1);for(let e of document.getElementById(t+"-content").getElementsByClassName("v-tag"))e.addEventListener("click",this.tagSelect.bind(this,e),!1);document.getElementById(t+"-search").addEventListener("input",(function(){let e=this.value;if(""==e)return;let i=document.getElementById(t+"-content");for(let t of i.getElementsByClassName("v-tag"))-1!=t.innerText.indexOf(e)&&i.insertBefore(t,i.firstChild)}),!1)}tagSelect(t){let e=t.cloneNode(!0);e.addEventListener("click",this.tagCancel.bind(this,e),!1),this.SELECT_DOM.appendChild(e),t.remove(),this.tagCal(e,"insert")}tagCancel(t){let e=t.cloneNode(!0);e.addEventListener("click",this.tagSelect.bind(this,e),!1),this.CONTENT_DOM.appendChild(e),t.remove(),this.tagCal(e,"delete")}tagCal(t,e){let i=t.getAttribute("data-id");if("insert"!=e){if("delete"==e){let t=this.select_data.indexOf(i);-1!=t&&(this.select_data.splice(t,1),this.dataDOM.value=JSON.stringify(this.select_data)),-1!=this.selected_data.indexOf(i)&&-1==this.delete_data.indexOf(i)&&(this.delete_data.push(i),this.deleteDOM.value=JSON.stringify(this.delete_data)),t=this.insert_data.indexOf(i),-1!=t&&(this.insert_data.splice(t,1),this.insertDOM.value=JSON.stringify(this.insert_data))}}else{-1==this.select_data.indexOf(i)&&(this.select_data.push(i),this.dataDOM.value=JSON.stringify(this.select_data)),-1==this.selected_data.indexOf(i)&&-1==this.insert_data.indexOf(i)&&(this.insert_data.push(i),this.insertDOM.value=JSON.stringify(this.insert_data));let t=this.delete_data.indexOf(i);-1!=t&&(this.delete_data.splice(t,1),this.deleteDOM.value=JSON.stringify(this.delete_data))}}}class ComponentLine{constructor(t,e,i,s={}){this.DOM=document.getElementById(t),this.NAME=t,this.COLUMNS=e,this.DATA=i,this.OPTIONS=Object.assign({sortable:!0,delete:!0},s);let n=this.makeHead();this.DATA_INPUT=document.createElement("input"),this.DATA_INPUT.setAttribute("name",t),this.DATA_INPUT.setAttribute("type","hidden"),this.DATA_INPUT.value="[]",this.DOM.appendChild(this.DATA_INPUT),this.makeBody(),this.makeFoot(n),this.OPTIONS.sortable&&this.sortable()}makeHead(){let t='<tr style="display:table;width:100%;table-layout:fixed;">',e=t,i=this.COLUMNS;for(let s in i)"hidden"!=i[s].type&&(i[s].style?(t+=`<th style="${i[s].style}">${i[s].name}</th>`,e+=`<th style="${i[s].style}"><input class="form-control" data-column="${s}" placeholder=":${i[s].name}"/></th>`):(t+="<th>"+i[s].name+"</th>",e+=`<th><input class="form-control" data-column="${s}" placeholder=":${i[s].name}"/></th>`));return t+='<th style="width: 50px"></th></tr>',e+='<th style="width: 50px" class="JsonTableInsert"></th></tr>',this.DOM.insertAdjacentHTML("afterbegin",`<style>#${this.NAME} tbody::-webkit-scrollbar { width: 0 !important }</style>\n        <table class="table table-striped table-bordered table-hover table-responsive" style="height: 100%"><thead>${t}</thead></table>`),this.TABLE_DOM=this.DOM.getElementsByTagName("table")[0],e}makeBody(){var t=[],e=document.createElement("tbody"),i=this,s=this.COLUMNS;this.DATA.forEach((function(n,a){let l=document.createElement("tr");l.setAttribute("sortable-item","sortable-item");let o={};for(let t in s){if("hidden"==s[t].type){n[t]&&(o[t]=n[t]);continue}let e=document.createElement("td");n[t]?(o[t]=n[t],i.makeTd(e,s[t].type,n[t],t),s[t].style&&(e.style=s[t].style)):(o[t]="",i.makeTd(e,s[t].type,"",t),s[t].style&&(e.style=s[t].style)),l.setAttribute("style","display:table;width:100%;table-layout:fixed"),l.setAttribute("data-key",a),l.appendChild(e)}let d=document.createElement("td");i.operateButton(d),l.appendChild(d),e.appendChild(l),t.push(o),i.DATA=t,i.DATA_INPUT.value=JSON.stringify(t)})),e.setAttribute("style","display:block;height:100%;overflow-y:scroll"),e.setAttribute("sortable-list","sortable-list"),this.TBODY_DOM=e,this.TABLE_DOM.appendChild(e)}makeFoot(t){let e=document.createElement("tfoot");e.style="background:#f3ffdb",e.insertAdjacentHTML("afterbegin",t),this.TABLE_DOM.appendChild(e);var i=this,s=document.createElement("i");s.setAttribute("class","fa fa-edit"),s.style="cursor: pointer",s.addEventListener("click",(function(){let t=i.DOM.getElementsByTagName("tfoot")[0].getElementsByTagName("input"),e={},s=document.createElement("tr");s.style="display:table;width:100%;table-layout:fixed",s.setAttribute("sortable-item","sortable-item"),s.setAttribute("data-key",i.DATA.length);for(let n in t)if(t.hasOwnProperty(n)){let a=document.createElement("td"),l=t[n].getAttribute("data-column");e[l]=t[n].value,i.makeTd(a,i.COLUMNS[l].type,t[n].value,l),i.COLUMNS[l].style&&(a.style=i.COLUMNS[l].style),s.appendChild(a),t[n].value=""}let n=document.createElement("td");i.operateButton(n),s.appendChild(n),i.TBODY_DOM.appendChild(s),i.DATA.push(e),i.DATA_INPUT.value=JSON.stringify(i.DATA),i.TBODY_DOM.scrollTop=i.TBODY_DOM.scrollHeight}),!1),this.DOM.getElementsByClassName("JsonTableInsert")[0].appendChild(s)}makeTd(t,e,i,s,n){var a=this;switch(e){case"text":default:t.insertAdjacentHTML("afterbegin",`<p style="text-overflow: ellipsis;overflow: hidden;display: block;white-space: nowrap;" title="${i}">${i}</p>`);break;case"input":let e=document.createElement("input");e.setAttribute("class","form-control"),e.setAttribute("data-column",s),e.value=i,e.style="width:100%;padding:1px";for(let t in n)e.setAttribute(t,n[t]);e.addEventListener("input",(function(){let t=this.parentNode.parentNode.getAttribute("data-key"),e=this.getAttribute("data-column");a.DATA[t]&&(a.DATA[t][e]=this.value,a.DATA_INPUT.value=JSON.stringify(a.DATA))}),!1),t.appendChild(e)}}operateButton(t){var e=this;if(this.OPTIONS.sortable){let e=document.createElement("i");e.setAttribute("class","fa fa-arrows"),e.setAttribute("style","cursor: pointer;margin-right:5px;"),e.setAttribute("sortable-handle","sortable-handle"),t.appendChild(e)}if(this.OPTIONS.delete){let i=document.createElement("i");i.setAttribute("class","fa fa-trash"),i.setAttribute("style","cursor: pointer"),i.addEventListener("click",(function(){let t=this.parentNode.parentNode,i=t.parentNode,s=t.getAttribute("data-key");e.DATA.splice(s,1),i.removeChild(t),e.DATA_INPUT.value=JSON.stringify(e.DATA);for(let t in i.childNodes)i.childNodes[t]instanceof HTMLElement&&i.childNodes[t].setAttribute("data-key",t)}),!1),t.appendChild(i)}t.style="width:50px"}sortable(){var t=this;this.SORTABLE=new ComponentSortable(this.TBODY_DOM,(function(e){let i=[];e.forEach((function(e){i.push(t.DATA[e])})),t.DATA=i,t.DATA_INPUT.value=JSON.stringify(t.DATA)}))}}class ComponentPlane{constructor(t,e="",i="POST",s=null,n={}){this.URL=t,this.XHR_URL=e,this.METHOD=i,this.CALLBACK=s,this.OPTIONS=Object.assign({W:.8,H:.8},n),this.makeModal(),this.makeContent()}makeModal(){let t=`<div id="dlp" class="modal" style="display: block;">\n<div class="modal-dialog modal-lg" style="width: ${window.innerWidth*this.OPTIONS.W}px;">\n<div class="modal-content">\n    <div class="modal-header" style="background-color: rgb(255, 255, 255); padding: 3px; display: flex; justify-content: flex-end;"></div>\n    <div class="modal-body" style="background-color: rgb(244, 244, 244); padding: 0px; overflow-y: auto; max-height:${window.innerHeight*this.OPTIONS.H} px; min-height: ${window.innerHeight*this.OPTIONS.H/2} px;"></div>\n</div></div></div>`;document.body.insertAdjacentHTML("beforeEnd",t);let e=document.createElement("i");e.setAttribute("class","fa fa-close"),e.setAttribute("style","cursor: pointer"),e.addEventListener("click",(function(){document.getElementById("dlp")instanceof HTMLElement&&document.getElementById("dlp").remove(),document.getElementById("kvFileinputModal")instanceof HTMLElement&&document.getElementById("kvFileinputModal").remove()}),!1),document.getElementsByClassName("modal-header")[0].append(e),this.MODEL_BODY_DOM=document.getElementsByClassName("modal-body")[0]}makeContent(){this.loading();var t=this;_componentRequest(this.URL,"GET",{},(function(e){t.loading(!0),$(".modal-body").append(e);let i=document.querySelector('.modal-body button[type="submit"]');i instanceof HTMLElement&&i.addEventListener("click",t.submitEvent.bind(t,i),!1)}))}submitEvent(t){t.setAttribute("disabled","disabled"),t.innerText="提交中...";let e=this.MODEL_BODY_DOM.getElementsByTagName("form")[0],i=new FormData(e);var s=this;_componentRequest(this.XHR_URL,this.METHOD,i,(function(e){"function"!=typeof s.CALLBACK?0!=e.code?_componentAlert(e.message,3,(function(){t.removeAttribute("disabled"),t.innerText="提交"})):window.location.reload():s.CALLBACK(e)}))}loading(t=!1){if(t&&this.LOADING_DOM)return this.MODEL_BODY_DOM.removeChild(this.LOADING_DOM),void(this.LOADING_DOM=null);if(this.LOADING_DOM instanceof HTMLElement)return;this.LOADING_DOM=document.createElement("div"),this.LOADING_DOM.style="width: 100%;height: 100px;",this.LOADING_DOM.insertAdjacentHTML("afterbegin",'<svg version="1.1" style=\'width: 100%;height:100px\' xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n    width="40px" height="40px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve">\n    <path opacity="0.2" fill="#000" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946\n    s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634\n    c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z"/>\n    <path fill="#000" d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0\n    C22.32,8.481,24.301,9.057,26.013,10.047z"><animateTransform attributeType="xml"attributeName="transform"\n   type="rotate"from="0 20 20"to="360 20 20"dur="0.5s"repeatCount="indefinite"/></path></svg>');let e=this.MODEL_BODY_DOM.childNodes[0];e instanceof HTMLElement?this.MODEL_BODY_DOM.insertBefore(loading,e):this.MODEL_BODY_DOM.append(this.LOADING_DOM)}}class ComponentSortable{constructor(t,e=null){this.list="string"==typeof t?document.querySelector(t):t,this.options={animationSpeed:200,animationEasing:"ease-out"},this.callback=e,this.animation=!1,this.dragStart=this.dragStart.bind(this),this.dragMove=this.dragMove.bind(this),this.dragEnd=this.dragEnd.bind(this),this.list.addEventListener("touchstart",this.dragStart,!1),this.list.addEventListener("mousedown",this.dragStart,!1)}reset(){this.items=Array.from(this.list.children),this.items[this.items.length-1].offsetTop>this.list.offsetHeight?this.listHeight=this.list.scrollHeight:this.listHeight=this.items[this.items.length-1].offsetTop}dragStart(t){if(this.reset(),this.animation)return;if(this.items.length<2)return;this.handle=null;let e=t.target;for(;e&&(e.hasAttribute("sortable-handle")&&(this.handle=e),e.hasAttribute("sortable-item")&&(this.item=e),!e.hasAttribute("sortable-list"));)e=e.parentElement;if(!this.handle)return;this.list.style.position="relative",this.item.classList.add("is-dragging"),this.itemHeight=this.items[1].offsetTop,this.startTouchY=this.getDragY(t),this.startTop=this.item.offsetTop;const i=this.items.map((t=>t.offsetTop));this.items.forEach(((t,e)=>{t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.transform=`translateY(${i[e]}px)`,t.style.zIndex=t==this.item?2:1})),this.positions=this.items.map(((t,e)=>e)),this.position=Math.round(this.startTop/this.listHeight*this.items.length),this.touch="touchstart"==t.type,window.addEventListener(this.touch?"touchmove":"mousemove",this.dragMove),window.addEventListener(this.touch?"touchend":"mouseup",this.dragEnd,!1)}dragMove(t){if(this.animation)return;if(this.items.length<2)return;const e=this.startTop+this.getDragY(t)-this.startTouchY,i=Math.round(e/this.listHeight*this.items.length);this.item.style.transform=`translateY(${e}px)`,this.positions.forEach((t=>{t!=this.position&&t==i&&(this.swapElements(this.positions,this.position,t),this.position=t)})),this.items.forEach(((t,e)=>{t!=this.item&&(t.style.transform=`translateY(${this.positions.indexOf(e)*this.itemHeight}px)`,t.style.transition=`transform ${this.options.animationSpeed}ms ${this.options.animationEasing}`)})),t.preventDefault()}dragEnd(t){this.animation=!0,this.items.length<2||(this.item.style.transition=`all ${this.options.animationSpeed}ms ${this.options.animationEasing}`,this.item.style.transform=`translateY(${this.position*this.itemHeight}px)`,this.item.classList.remove("is-dragging"),"function"==typeof this.callback&&this.callback(this.positions),setTimeout((()=>{this.list.style.position="",this.items.forEach((t=>{t.style.top="",t.style.left="",t.style.right="",t.style.position="",t.style.transform="",t.style.transition="",t.style.zIndex=""})),this.positions.map((t=>{this.items[t]&&this.list.appendChild(this.items[t])})),this.animation=!1}),this.options.animationSpeed),window.removeEventListener(this.touch?"touchmove":"mousemove",this.dragMove,{passive:!1}),window.removeEventListener(this.touch?"touchend":"mouseup",this.dragEnd,!1))}swapElements(t,e,i){const s=t[e];t[e]=t[i],t[i]=s}getDragY(t){return t.touches?(t.touches[0]||t.changedTouches[0]).pageY:t.pageY}}