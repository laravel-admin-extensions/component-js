window._component={trash:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">\n  <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>\n  <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>\n</svg>',move:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">\n  <path d="M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>\n</svg>',write:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">\n  <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>\n  <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>\n</svg>',close:'<svg style="vertical-align: middle;" width="14" height="14" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill="none" stroke="white" stroke-width="2.5" d="M16,16 L4,4"></path><path fill="none" stroke="white" stroke-width="2.5" d="M16,4 L4,16"></path></svg>',check:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">\n  <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>\n</svg>',check_circle:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">\n  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>\n  <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>\n</svg>',caret_right:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">\n  <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>\n</svg>',caret_right_circle:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">\n  <path d="M6 12.796V3.204L11.481 8 6 12.796zm.659.753 5.48-4.796a1 1 0 0 0 0-1.506L6.66 2.451C6.011 1.885 5 2.345 5 3.204v9.592a1 1 0 0 0 1.659.753z"/>\n</svg>',sub_loading:'<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="16px" height="16px" viewBox="0 0 50 50" style="background: rgb(223 9 127);border-radius: 50%;" xml:space="preserve">\n  <path fill="#ffffff" stroke="#ffffff" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z">\n    <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform>\n    </path>\n  </svg>',node:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-diagram-3-fill" viewBox="0 0 16 16">\n  <path fill-rule="evenodd" d="M6 3.5A1.5 1.5 0 0 1 7.5 2h1A1.5 1.5 0 0 1 10 3.5v1A1.5 1.5 0 0 1 8.5 6v1H14a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0v-1A.5.5 0 0 1 2 7h5.5V6A1.5 1.5 0 0 1 6 4.5v-1zm-6 8A1.5 1.5 0 0 1 1.5 10h1A1.5 1.5 0 0 1 4 11.5v1A1.5 1.5 0 0 1 2.5 14h-1A1.5 1.5 0 0 1 0 12.5v-1zm6 0A1.5 1.5 0 0 1 7.5 10h1a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 8.5 14h-1A1.5 1.5 0 0 1 6 12.5v-1zm6 0a1.5 1.5 0 0 1 1.5-1.5h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5v-1z"/>\n</svg>',request:function(e,t="GET",i={},s=null,n=null){let a=new XMLHttpRequest;"GET"===t&&(e=_component.parseParams(e,i)),a.open(t,e,!0),a.timeout=3e4;let l="";document.querySelector('meta[name="csrf-token"]')&&(l=document.querySelector('meta[name="csrf-token"]').getAttribute("content")),a.setRequestHeader("X-CSRF-TOKEN",l),"GET"===t?(a.setRequestHeader("Content-type","application/text;charset=UTF-8"),a.responseType="text",a.send(null)):(a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.responseType="json",a.send(i)),a.onload=function(){this.status>=200&&this.status<300||"function"==typeof n&&n()},a.onreadystatechange=function(){if(a.readyState===a.DONE&&200===a.status){let e=a.response;"function"==typeof s&&s(e)}},a.onerror=function(e){console.error(e),"function"==typeof n&&n(e)}},parseParams(e,t){let i=[];return 0===Object.keys(t).length||(Object.keys(t).forEach((e=>t[e]&&i.push(`${e}=${t[e]}`))),-1===e.search(/\?/)?e+=`?${i.join("&")}`:e+=`&${i.join("&")}`),e},loading:function(e,t=!1){t?e.innerHTML="":e.insertAdjacentHTML("afterbegin",'<div class="dlp-loader">\n        <div class="dlp-loader-inner">\n            <div class="dlp-loader-line-wrap"><div class="dlp-loader-line"></div></div>\n            <div class="dlp-loader-line-wrap"><div class="dlp-loader-line"></div></div>\n            <div class="dlp-loader-line-wrap"><div class="dlp-loader-line"></div></div>\n            <div class="dlp-loader-line-wrap"><div class="dlp-loader-line"></div></div>\n            <div class="dlp-loader-line-wrap"><div class="dlp-loader-line"></div></div>\n        </div></div>')},alert:function(e,t=1,i=null){let s=document.createElement("div");s.innerHTML=e;let n=window.innerWidth/2-140,a="z-index: 1000000; position: fixed;background-color: rgba(0,0,0,.6);color: #fff;width: 320px;max-height: 450px;line-height: 30px;overflow: hidden;border-radius: 3px;text-align: center;display: block;top:"+(window.innerHeight/2-145)+"px;left:"+n+"px;";s.setAttribute("style",a),document.getElementsByTagName("BODY")[0].appendChild(s),setTimeout((()=>{s.parentNode.removeChild(s),"function"==typeof i&&i()}),1e3*t)},contextmenu:function(e,t,i={}){i=Object.assign({W:"70px"},i);let s=document.createElement("ul");s.className="dlp dlp-contextmenu",t.forEach((e=>{let t=document.createElement("li");t.className="dlp dlp-text",t.textContent=e.title,t.style.width=i.W,"function"==typeof e.func&&(t.addEventListener("click",(()=>{s.remove(),setTimeout((()=>{e.func()}),100)})),s.append(t))})),s.style.top=e.pageY-3+"px",s.style.left=e.pageX-3+"px",s.addEventListener("contextmenu",(e=>{e.preventDefault()})),s.addEventListener("mouseleave",(()=>{s.remove()})),document.getElementsByTagName("BODY")[0].appendChild(s)},dimensional(e,t,i=0,s=[]){if(Array.isArray(t)){for(let n in t){if(!t.hasOwnProperty(n))continue;let a=s.slice(0);a.push(t[n].key),_component.dimensional(e,t[n],i,a)}return}let n=s.slice(0);n.pop(),t.parentNodes=n,Array.isArray(e[i])?e[i].push(t):e[i]=[t],t.hasOwnProperty("nodes")&&Array.isArray(t.nodes)&&0!==t.nodes.length&&(i++,_component.dimensional(e,t.nodes,i,s))}},window.ComponentDot=class{MODE={insert:"insert",delete:"delete"};constructor(e,t,i,s=0,n={}){if(!Array.isArray(i))return void console.error("Dot param selected must be array!");if(Array.isArray(t)||"object"!=typeof t)return void console.error("Dot param select must be object such as {key:val,key2:val2,...} !");this.select=t,this.name=e,this.limit=s,this.DOM=document.getElementById(e),this.DOM.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.menu=Object.assign({mode:!1,placeholder:"未选择",height:"150px"},n),this.selected_data=i,this.select_data=[],this.insert_data=[],this.delete_data=[],setTimeout((()=>{let e=[];this.CONTENT_DOM.childNodes.forEach((t=>{let s=parseInt(t.getAttribute("data-id"));-1!==i.indexOf(s)&&e.push(t)})),e.forEach((e=>e.click())),!0===this.menu.mode&&(this.DOM.querySelector(".menu-list").style.display="none")})),!1===this.menu.mode?this.make(i,t):(this.menu_placeholder=this.menu.placeholder,this.menuMake(i,t));let a=this.DOM.querySelector(".dot-search");a.addEventListener("input",(()=>{setTimeout((()=>{this.search(a,this.menu.mode)}),500)}))}make(e,t){let i="";for(let e in t)t.hasOwnProperty(e)&&(i+=`<div class="dlp dlp-label dlp-text" data-id="${e}" title="${t[e]}"><span>${t[e]}</span></div>`);let s=`<div class="dlp dlp-dot" ><div class="dot-top"><input type="text" class="dlp dot-search" placeholder="搜索名称"><div class="dot-selected dlp-scroll"></div></div><div class="dot-body"><div class="dot-select dlp-scroll">${i}</div></div></div>\n<input name="${this.name}[select]" value='${JSON.stringify(e)}' type="hidden"><input name="${this.name}[insert]" value="[]" type="hidden"><input name="${this.name}[delete]" value="[]" type="hidden">`;this.DOM.insertAdjacentHTML("afterbegin",s),this.SELECTED_DOM=document.querySelector(`#${this.name}  .dot-selected`),this.CONTENT_DOM=document.querySelector(`#${this.name}  .dot-select`),this.selectInputDOM=document.querySelector(`input[name='${this.name}[select]']`),this.insertInputDOM=document.querySelector(`input[name='${this.name}[insert]']`),this.deleteInputDOM=document.querySelector(`input[name='${this.name}[delete]']`);for(let e of this.CONTENT_DOM.getElementsByClassName("dlp-label"))e.addEventListener("click",this.tagSelect.bind(this,e),!1)}menuMake(e,t){let i=document.createElement("div");i.className="dlp-dot-menu";let s=document.createElement("div");s.className="dlp-input dlp-dot-menu-select",s.insertAdjacentHTML("afterbegin",`<div class="dlp dlp-text">${this.menu_placeholder}</div><div>▼</div>`);let n=document.createElement("div");n.className="menu-list";let a=document.createElement("div");a.className="search-box";let l=document.createElement("input");l.className="dlp dlp-input dot-search",l.setAttribute("placeholder","搜索");let d=document.createElement("div");d.className="list dlp-scroll",d.style.maxHeight=this.menu.height;let r=_component.check;r=r.replace('width="16" height="16"','width="12" height="12"'),this.id_line_hash=[];let o=0;for(let e in t){if(!t.hasOwnProperty(e))continue;this.id_line_hash[e]=o,o++;let i=document.createElement("div");i.className="option",i.setAttribute("data-id",e),i.insertAdjacentHTML("afterbegin",`<div class="dlp dlp-text" data-v="${e}">${t[e]}</div><div></div>`),i.addEventListener("click",(()=>{if(e=parseInt(e),-1!==this.select_data.indexOf(e))return this.tagCal(e,this.MODE.delete),i.classList.remove("option-active"),i.lastChild instanceof HTMLElement&&(i.lastChild.innerHTML=""),this.menuSelect(t),void(0===this.select_data.length&&(this.SELECTED_DOM.textContent=this.menu_placeholder));this.limit>0&&this.select_data.length>=this.limit&&d.childNodes[this.id_line_hash[this.select_data[0].toString()]].click(),i.classList.add("option-active"),this.tagCal(e,this.MODE.insert),i.lastChild instanceof HTMLElement&&i.lastChild.insertAdjacentHTML("afterbegin",r),this.menuSelect(t)}),!1),d.append(i)}i.append(s),a.append(l),n.append(a),n.append(d),i.append(n),i.addEventListener("click",(()=>{n.style.display="flex"})),i.addEventListener("mouseleave",(()=>{n.style.display="none",this.DOM.querySelector(".dot-search").value="";for(let e of this.CONTENT_DOM.childNodes)e.style.display="flex"})),this.DOM.append(i),this.DOM.insertAdjacentHTML("beforeend",`<input name="${this.name}[select]" value='${JSON.stringify(e)}' type="hidden"><input name="${this.name}[insert]" value="[]" type="hidden"><input name="${this.name}[delete]" value="[]" type="hidden">`),this.SELECTED_DOM=document.querySelector(`#${this.name}  .dlp-dot-menu-select`).firstElementChild,this.CONTENT_DOM=document.querySelector(`#${this.name}  .list`),this.selectInputDOM=document.querySelector(`input[name='${this.name}[select]']`),this.insertInputDOM=document.querySelector(`input[name='${this.name}[insert]']`),this.deleteInputDOM=document.querySelector(`input[name='${this.name}[delete]']`)}menuSelect(e){if(1===this.limit)return void(this.SELECTED_DOM.innerHTML=`<p class="dlp-text">${e[this.select_data[0]]}</p>`);let t="";for(let i of this.select_data)t+=`<span class="dlp-text" title="${e[i]}">${e[i]}</span>`;this.SELECTED_DOM.innerHTML=t}tagSelect(e){this.limit>0&&this.select_data.length>=this.limit&&this.SELECTED_DOM.firstChild instanceof HTMLElement&&this.SELECTED_DOM.firstChild.click();let t=e.cloneNode(!0);t.addEventListener("click",this.tagCancel.bind(this,t),!1),this.SELECTED_DOM.appendChild(t),e.remove(),this.tagCal(parseInt(e.getAttribute("data-id")),this.MODE.insert),this.SELECTED_DOM.scrollTop=this.SELECTED_DOM.scrollHeight}tagCancel(e){let t=e.cloneNode(!0);t.addEventListener("click",this.tagSelect.bind(this,t),!1),this.CONTENT_DOM.appendChild(t),e.remove(),this.tagCal(parseInt(e.getAttribute("data-id")),this.MODE.delete)}tagCal(e,t){let i=this.select_data.indexOf(e);t===this.MODE.insert?(-1===i&&(this.select_data.push(e),this.selectInputDOM.value=JSON.stringify(this.select_data)),-1===this.selected_data.indexOf(e)&&-1===this.insert_data.indexOf(e)&&(this.insert_data.push(e),this.insertInputDOM.value=JSON.stringify(this.insert_data)),i=this.delete_data.indexOf(e),-1!==i&&(this.delete_data.splice(i,1),this.deleteInputDOM.value=JSON.stringify(this.delete_data))):(-1!==i&&(this.select_data.splice(i,1),this.selectInputDOM.value=JSON.stringify(this.select_data)),-1!==this.selected_data.indexOf(e)&&-1===this.delete_data.indexOf(e)&&(this.delete_data.push(e),this.deleteInputDOM.value=JSON.stringify(this.delete_data)),i=this.insert_data.indexOf(e),-1!==i&&(this.insert_data.splice(i,1),this.insertInputDOM.value=JSON.stringify(this.insert_data)))}search(e,t){if(t){if(""===e.value){for(let e of this.CONTENT_DOM.childNodes)e.style.display="flex";return}for(let t in this.select){if(!this.select.hasOwnProperty(t))continue;let i=this.select[t],s=this.id_line_hash[t];-1!==i.indexOf(e.value)||-1!==e.value.indexOf(i)?this.CONTENT_DOM.childNodes[s].style.display="flex":this.CONTENT_DOM.childNodes[s].style.display="none"}return}if(""===e.value){if(this.SELECT_COVER_DOM instanceof HTMLElement){let e=[];this.SELECT_COVER_DOM.childNodes.forEach((t=>{e.push(t)})),this.CONTENT_DOM.append(...e),this.SELECT_COVER_DOM.remove(),this.SELECT_COVER_DOM=null}return}if(this.SELECT_COVER_DOM instanceof HTMLElement){let e=[];this.SELECT_COVER_DOM.childNodes.forEach((t=>{e.push(t)})),this.CONTENT_DOM.append(...e)}else this.SELECT_COVER_DOM=document.createElement("div"),this.SELECT_COVER_DOM.className="dot-select dlp-scroll dot-select-cover",this.CONTENT_DOM.parentNode.appendChild(this.SELECT_COVER_DOM);let i=[];for(let t of this.CONTENT_DOM.childNodes)-1!==t.className.indexOf("dlp-label")&&(-1===t.innerText.indexOf(e.value)&&-1===e.value.indexOf(t.innerText)||i.push(t));this.SELECT_COVER_DOM.append(...i)}},window.ComponentCascadeDot=class{MODE={insert:"insert",delete:"delete"};constructor(e,t,i,s=0){if(!Array.isArray(i)||!Array.isArray(t))return void console.error("CascadeDot param selected and select must be array!");this.name=e,this.limit=s,this.DOM=document.getElementById(e),this.selected_data=i,this.select_data=[],this.insert_data=[],this.delete_data=[],this.make().makeSelect(t),setTimeout((()=>{this.selected_label_dom.forEach((e=>{e.click()}))})),this.selectInputDOM.value=JSON.stringify(this.select_data);let n=document.querySelector(`#${this.name} .dot-search`);n.addEventListener("input",(()=>{setTimeout((()=>{this.search(n)}),500)}))}make(){let e=`<div class="dlp dlp-dot"><div class="dot-top"><input type="text" class="dlp dot-search" placeholder="搜索名称"><div id="${this.name}-select" class="dot-selected dlp-scroll"></div></div><div class="dot-body"><div class="dot-select dot-select-cascade"></div></div></div>\n<input name="${this.name}[select]" value="[]" type="hidden"><input name="${this.name}[insert]" value="[]" type="hidden"><input name="${this.name}[delete]" value="[]" type="hidden">`;return this.DOM.insertAdjacentHTML("afterbegin",e),this.DOM.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.SELECTED_DOM=document.querySelector(`#${this.name} .dot-selected`),this.CONTENT_DOM=document.querySelector(`#${this.name} .dot-select`),this.selectInputDOM=document.querySelector(`input[name='${this.name}[select]']`),this.insertInputDOM=document.querySelector(`input[name='${this.name}[insert]']`),this.deleteInputDOM=document.querySelector(`input[name='${this.name}[delete]']`),this}makeSelect(e){this.dimensional_data=[],this.selected_label_dom=[],_component.dimensional(this.dimensional_data,e);let t=this;for(let e in this.dimensional_data){if(!this.dimensional_data.hasOwnProperty(e))continue;e=parseInt(e);let i=this.dimensional_data[e],s=document.createElement("div");s.className="dot-cascade-stack dlp-scroll",i.forEach(((i,n)=>{Array.isArray(i.nodes)&&0!==i.nodes.length?(i.nodes=i.nodes.map((e=>e.key)),i.expand=!1):(i.nodes=null,i.checked=!1);let a=document.createElement("div");a.className="dlp dlp-text dlp-label",a.insertAdjacentHTML("afterbegin",`<span>${i.val}</span>`),a.setAttribute("data-id",i.key),a.setAttribute("data-k",n),a.addEventListener("click",this.select.bind(this,a,e)),null!==i.nodes?(a.insertAdjacentHTML("afterbegin",`<i class="left">${_component.caret_right}</i>`),a.addEventListener("contextmenu",(i=>{i.target instanceof HTMLElement&&i.target.click(),i.preventDefault();let s=parseInt(a.getAttribute("data-k"));_component.contextmenu(i,[{title:"全选",func:()=>{t.checkAll(e+1,this.dimensional_data[e][s].nodes,!0),i.target instanceof HTMLElement&&i.target.click()}},{title:"取消",func:()=>{t.checkAll(e+1,this.dimensional_data[e][s].nodes,!1)}}])}))):a.addEventListener("contextmenu",(e=>{e.preventDefault()})),s.append(a);let l=this.selected_data.indexOf(parseInt(i.key));!1===i.checked||-1===l?-1!==l&&this.selected_label_dom.push(a):this.selected_data.splice(l,1)})),this.CONTENT_DOM.append(s)}return this.STACKS=this.CONTENT_DOM.childNodes,this}select(e,t){let i=parseInt(e.getAttribute("data-id")),s=parseInt(e.getAttribute("data-k")),n=this.dimensional_data[t][s],a=this.STACKS[t].childNodes,l=n.parentNodes[n.parentNodes.length-1];if(!0===n.checked){n.checked=!1,this.tagCal(i,this.MODE.delete),null!==e.querySelector("i.right")&&e.removeChild(e.querySelector("i.right"));for(let e of this.SELECTED_DOM.childNodes)if(parseInt(e.getAttribute("data-id"))===i){e.remove();break}}else this.dimensional_data[t].forEach(((e,t)=>{-1!==e.parentNodes.indexOf(l)?a[t].classList.remove("dlp-label-silence"):a[t].classList.add("dlp-label-silence"),this.expand(e,a[t],!1)})),!1===n.checked?(this.limit>0&&this.select_data.length>=this.limit&&this.SELECTED_DOM.firstChild instanceof HTMLElement&&this.SELECTED_DOM.firstChild.click(),n.checked=!0,this.tagCal(i,this.MODE.insert),e.classList.remove("dlp-label-silence"),null===e.querySelector("i.right")&&e.insertAdjacentHTML("beforeend",`<i class="right">${_component.check}</i>`),this.selectToChildren(t+1,n.nodes),this.selectToSelected(e,t),this.SELECTED_DOM.scrollTop=this.SELECTED_DOM.scrollHeight):(e.classList.remove("dlp-label-silence"),this.expand(n,e,!0),this.selectToChildren(t+1,n.nodes));if(Array.isArray(n.parentNodes)&&n.parentNodes.length>0){let e=n.parentNodes.slice(0);this.selectToParent(e,n.checked)}}selectToSelected(e,t){let i=document.createElement("div");i.className="dlp dlp-text dlp-label",i.setAttribute("data-id",e.getAttribute("data-id")),i.setAttribute("stack",t),i.insertAdjacentHTML("afterbegin",`<span>${e.querySelector("span").textContent}</span>`),i.addEventListener("click",(()=>{this.select(e,t)})),this.SELECTED_DOM.append(i)}selectToParent(e,t){let i=e.length-1,s=e.pop(),n=e[i-1],a=this.STACKS[i].childNodes,l=null;this.dimensional_data[i].forEach(((e,d)=>{let r=a[d],o=e.parentNodes;if(!0!==t&&void 0!==t||(o.length>0&&o[i-1]!==n||0===o.length&&parseInt(r.getAttribute("data-id"))!==s?(r.classList.add("dlp-label-silence"),this.expand(e,r,!1)):(r.classList.remove("dlp-label-silence"),parseInt(r.getAttribute("data-id"))===s?(null===l&&(l=d),this.expand(e,r,!0)):this.expand(e,r,!1))),!0===t&&s===e.key&&!0!==e.mark&&(e.mark=!0,r.insertAdjacentHTML("beforeend",`<i class="right">${_component.check_circle}</i>`)),!1===t&&s===e.key){let t=this.dimensional_data[i][d].nodes,s=!0;for(let e of this.dimensional_data[i+1])if(-1!==t.indexOf(e.key)&&(!0===e.checked||!0===e.mark)){s=!1;break}s&&r.querySelector("i.right")instanceof HTMLElement&&(e.mark=!1,r.querySelector("i.right").remove())}})),null!==l&&this.STACKS[i].scrollTo(0,27*l),e.length>0&&this.selectToParent(e,t)}selectToChildren(e,t){if(e>this.dimensional_data.length-1)return;let i=this.STACKS[e].childNodes,s=[],n=null;this.dimensional_data[e].forEach(((e,a)=>{let l=i[a];if(null!==t)if(-1!==t.indexOf(parseInt(l.getAttribute("data-id")))){l.classList.remove("dlp-label-silence");let t=e.nodes;Array.isArray(t)&&t.forEach((e=>{-1===s.indexOf(t)&&s.push(e)})),null===n&&(n=a),this.expand(e,l,!0)}else l.classList.add("dlp-label-silence"),this.expand(e,l,!1);else l.classList.add("dlp-label-silence")})),null!==n&&this.STACKS[e].scrollTo(0,27*n),this.selectToChildren(e+1,s)}expand(e,t,i=!0){if(e.expand===i)return;e.expand=i;let s=t.querySelector("i.left");s instanceof HTMLElement&&(s.innerHTML=i?_component.caret_right_circle:_component.caret_right)}tagCal(e,t){if(t!==this.MODE.insert){if(t===this.MODE.delete){let t=this.select_data.indexOf(e);-1!==t&&(this.select_data.splice(t,1),this.selectInputDOM.value=JSON.stringify(this.select_data)),-1!==this.selected_data.indexOf(e)&&-1===this.delete_data.indexOf(e)&&(this.delete_data.push(e),this.deleteInputDOM.value=JSON.stringify(this.delete_data)),t=this.insert_data.indexOf(e),-1!==t&&(this.insert_data.splice(t,1),this.insertInputDOM.value=JSON.stringify(this.insert_data))}}else{-1===this.select_data.indexOf(e)&&(this.select_data.push(e),this.selectInputDOM.value=JSON.stringify(this.select_data)),-1===this.selected_data.indexOf(e)&&-1===this.insert_data.indexOf(e)&&(this.insert_data.push(e),this.insertInputDOM.value=JSON.stringify(this.insert_data));let t=this.delete_data.indexOf(e);-1!==t&&(this.delete_data.splice(t,1),this.deleteInputDOM.value=JSON.stringify(this.delete_data))}}search(e){if(""!==e.value){if(!(this.SELECT_COVER_DOM instanceof HTMLElement)){this.COVER_STACK_HASH_DOM=[],this.SELECT_COVER_DOM=document.createElement("div"),this.SELECT_COVER_DOM.className="dot-select-cover dlp-scroll dot-select-cascade";for(let e=1;e<=this.dimensional_data.length;e++){let e=document.createElement("div");e.className="dot-cascade-stack dlp-scroll",this.SELECT_COVER_DOM.append(e)}this.CONTENT_DOM.parentNode.append(this.SELECT_COVER_DOM)}this.dimensional_data.forEach(((t,i)=>{this.searchPushTag(e,t,i)}))}else this.SELECT_COVER_DOM instanceof HTMLElement&&(this.SELECT_COVER_DOM.remove(),this.SELECT_COVER_DOM=null,this.COVER_STACK_HASH_DOM=[])}searchCoverClick(e,t,i){if(null===t.nodes)i instanceof HTMLElement&&i.click();else{let i=e+1;Array.isArray(this.dimensional_data[i])&&this.searchPushTag(t.nodes,this.dimensional_data[i],i)}}searchPushTag(e,t,i){t.forEach(((t,s)=>{if(Array.isArray(e)){if(-1===e.indexOf(t.key))return}else if(-1===t.val.indexOf(e.value)&&-1===e.value.indexOf(t.val))return;if(Array.isArray(this.COVER_STACK_HASH_DOM[i])&&-1!==this.COVER_STACK_HASH_DOM[i].indexOf(t.key))return;let n=document.createElement("div");n.className="dlp dlp-text dlp-label",n.textContent=t.val,null!==t.nodes&&n.insertAdjacentHTML("afterbegin",`<i class="left">${_component.caret_right}</i>`),n.addEventListener("click",(()=>this.searchCoverClick(i,t,this.STACKS[i].childNodes[s]))),this.SELECT_COVER_DOM.childNodes[i].prepend(n),Array.isArray(this.COVER_STACK_HASH_DOM[i])?this.COVER_STACK_HASH_DOM[i].push(t.key):this.COVER_STACK_HASH_DOM[i]=[t.key]}))}checkAll(e,t,i){if(e>this.dimensional_data.length-1)return;if(!Array.isArray(t)||t.length<=0)return;let s=this.STACKS[e].childNodes,n=[],a=null;s.forEach(((s,l)=>{if(-1!==t.indexOf(parseInt(s.getAttribute("data-id")))){let t=this.dimensional_data[e][l].checked;!0===i?!1===t&&s.click():!1===i&&!0===t&&s.click();let d=this.dimensional_data[e][l].nodes;Array.isArray(d)&&d.forEach((e=>{-1===n.indexOf(d)&&n.push(e)})),null===a&&(a=l)}})),null!==a&&this.STACKS[e].scrollTo(0,27*a),this.checkAll(e+1,n,i)}},window.ComponentLine=class{constructor(e,t,i,s={}){this.DOM=document.getElementById(e),this.NAME=e,this.DOM.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.format_settings={},this.COLUMNS=t,this.DATA=i,this.OPTIONS=Object.assign({sortable:!0,delete:!0,insert:!0},s);let n=this.makeHeadFoot();this.DATA_INPUT=document.createElement("input"),this.DATA_INPUT.setAttribute("name",e),this.DATA_INPUT.setAttribute("type","hidden"),this.DATA_INPUT.value="[]",this.DOM.appendChild(this.DATA_INPUT),this.makeBody(),this.makeFoot(n),this.datepicker(),this.OPTIONS.sortable&&this.sortable()}makeHeadFoot(){let e='<tr class="dlp-tr">',t=document.createElement("tr");t.className="dlp-tr";let i=this.COLUMNS;this.INSERT_ROW_MENUE_DATA={};for(let s in i){if(!i.hasOwnProperty(s))continue;let n=i[s];if("hidden"===n.type)continue;let a=n.style?`style="${n.style}"`:"";switch(e+=`<th class="dlp-text text-white" ${a}>${n.name}</th>`,n.insert_type?n.insert_type:n.type){case"input":t.insertAdjacentHTML("beforeend",`<th ${a}><input class="dlp dlp-input" data-column="${s}" placeholder=":${n.name}"/></th>`);break;case"select":let e=document.createElement("td");e.style=n.style,e.append(this.menuMake(s,[],n.options,n.options_limit,n.name,!0)),t.append(e);break;case"datetime":let i;switch(n.format){case 1:i="YYYY-MM-DD";break;case 2:i="YYYY";break;default:i="YYYY-MM-DD HH:mm:ss"}this.format_settings[s]=i,a=n.style?`${n.style}`:"",t.insertAdjacentHTML("beforeend",`<th style="position: relative;overflow: unset;${a}"><input class="dlp dlp-input datetime-${s}" data-column="${s}"/></th>`);break;case"hidden":t.insertAdjacentHTML("beforeend",`<th><input data-column="${s}" type="hidden"/></th>`);break;default:this.COLUMNS[s].insert_type="input",t.insertAdjacentHTML("beforeend",`<th ${a}><input class="dlp dlp-input" data-column="${s}" placeholder=":${n.name}"/></th>`)}}return e+='<th class="operate-column" style="width: 48px;"></th></tr>',t.insertAdjacentHTML("beforeend",'<th class="insert_handel operate-column" style="width: 48px;"></th></tr>'),this.DOM.insertAdjacentHTML("afterbegin",`<table class="dlp dlp-table" style="height: 100%"><thead class="dlp-thead">${e}</thead></table>`),this.TABLE_DOM=this.DOM.getElementsByTagName("table")[0],t}makeBody(){let e=[],t=document.createElement("tbody"),i=this.COLUMNS;!1!==Array.isArray(this.DATA)&&(this.DATA.forEach(((s,n)=>{let a=document.createElement("tr");a.className="dlp-tr",a.setAttribute("sortable-item","sortable-item");let l={};for(let e in i){if(!i.hasOwnProperty(e))continue;let t=i[e];s[e]||(this.DATA[n][e]="",l[e]="");let d=document.createElement("td"),r=this.DATA[n][e];"select"===t.type&&(/^[0-9]+$/.test(r)?r=[parseInt(r)]:!1===Array.isArray(r)&&(r=[])),this.makeTd(d,e,t,r),l[e]=r,a.appendChild(d)}let d=document.createElement("td");this.operateButton(d),a.appendChild(d),t.appendChild(a),e.push(l)})),this.DATA=e,this.DATA_INPUT.value=JSON.stringify(e),t.setAttribute("sortable-list","sortable-list"),t.className="dlp-tbody dlp-scroll",this.TBODY_DOM=t,this.TABLE_DOM.appendChild(t))}makeFoot(e){let t=document.createElement("tfoot");if(t.className="dlp-tfoot",!this.OPTIONS.insert)return t.insertAdjacentHTML("afterbegin","<tr></tr>"),void this.TABLE_DOM.appendChild(t);t.append(e),this.TABLE_DOM.appendChild(t);let i=document.createElement("i");i.className="dlp text-white",i.style.cursor="pointer",i.insertAdjacentHTML("afterbegin",_component.write),i.addEventListener("click",(()=>{let e=this.DOM.getElementsByTagName("tfoot")[0],t={},i=document.createElement("tr");i.className="dlp-tr",i.setAttribute("sortable-item","sortable-item");for(let s in this.COLUMNS){if(!this.COLUMNS.hasOwnProperty(s))continue;let n,a=this.COLUMNS[s].insert_type?this.COLUMNS[s].insert_type:this.COLUMNS[s].type,l=document.createElement("td");n="input"===a||"datetime"===a?e.querySelector(`input[data-column="${s}"]`).value:"select"===a?this.INSERT_ROW_MENUE_DATA[s]:"",t[s]=n,this.makeTd(l,s,this.COLUMNS[s],n),i.appendChild(l)}let s=document.createElement("td");this.operateButton(s),i.appendChild(s),this.TBODY_DOM.appendChild(i),this.DATA.push(t),this.DATA_INPUT.value=JSON.stringify(this.DATA),this.TBODY_DOM.scrollTop=this.TBODY_DOM.scrollHeight,this.datepicker()}),!1),this.TABLE_DOM.querySelector(".insert_handel").appendChild(i)}makeTd(e,t,i,s){let n,a=this.DATA,l=this.DATA_INPUT;switch(i.type){case"text":default:e.insertAdjacentHTML("afterbegin",`<p style="display: block;" class="dlp text-white dlp-text" title="${s}">${s}</p>`);break;case"input":n=document.createElement("input"),n.className="dlp dlp-input",n.setAttribute("data-column",t),n.value=s,n.addEventListener("input",(()=>{let e=this.searchChildrenDomIndex(n.parentNode.parentNode),t=n.getAttribute("data-column");a[e]&&(a[e][t]=n.value,l.value=JSON.stringify(a))}),!1),e.appendChild(n);break;case"datetime":let d;switch(n=document.createElement("input"),n.setAttribute("class",`dlp dlp-input datetime-${t}`),n.setAttribute("data-column",t),n.value=s,i.format){case 1:d="YYYY-MM-DD";break;case 2:d="YYYY";break;default:d="YYYY-MM-DD HH:mm:ss"}this.format_settings[t]=d,n.addEventListener("blur",(()=>{let e=this.searchChildrenDomIndex(n.parentNode.parentNode),t=n.getAttribute("data-column");a[e]&&(a[e][t]=n.value,l.value=JSON.stringify(a))}),!1),e.appendChild(n),e.style.position="relative";break;case"select":e.append(this.menuMake(t,s,i.options,i.options_limit,i.name))}i.style&&(e.style=i.style)}operateButton(e){if(this.OPTIONS.sortable){let t=document.createElement("i");t.className="dlp text-white",t.setAttribute("style","cursor: pointer;margin-right:5px;"),t.setAttribute("sortable-handle","sortable-handle"),t.insertAdjacentHTML("afterbegin",_component.move),e.appendChild(t)}if(this.OPTIONS.delete){let t=document.createElement("span");t.className="dlp text-white",t.setAttribute("style","cursor: pointer;display: inline-block;"),t.insertAdjacentHTML("afterbegin",_component.trash),t.addEventListener("click",(()=>{let e=t.parentNode.parentNode,i=e.parentNode,s=this.searchChildrenDomIndex(e);this.DATA.splice(s,1),i.removeChild(e),this.DATA_INPUT.value=JSON.stringify(this.DATA)}),!1),e.appendChild(t)}e.className="operate-column"}menuMake(e,t,i,s,n,a=!1){let l=document.createElement("div");l.className="dlp-dot-menu",a&&(this.INSERT_ROW_MENUE_DATA[e]=[]);let d=document.createElement("div");d.className="dlp-input dlp-dot-menu-select",d.insertAdjacentHTML("afterbegin",`<div class="dlp dlp-text">${n}</div><div>▼</div>`);let r=document.createElement("div");r.className="menu-list";let o=document.createElement("div");o.className="search-box";let c=document.createElement("input");c.className="dlp dlp-input dot-search",c.setAttribute("placeholder","搜索"),c.addEventListener("input",(()=>{setTimeout((()=>{if(""!==c.value)for(let e of h.childNodes){let t=e.firstElementChild.innerText;-1!==t.indexOf(c.value)||-1!==c.value.indexOf(t)?e.style.display="flex":e.style.display="none"}else for(let e of h.childNodes)e.style.display="flex"}),300)}));let h=document.createElement("div");h.className="list dlp-scroll";let p=_component.check;p=p.replace('width="16" height="16"','width="12" height="12"');for(let r in i){if(!i.hasOwnProperty(r))continue;let o=document.createElement("div");o.className="option",o.setAttribute("data-id",r),o.insertAdjacentHTML("afterbegin",`<div class="dlp dlp-text" data-v="${r}">${i[r]}</div><div></div>`),o.addEventListener("click",(()=>{let t;if(r=parseInt(r),a)t=this.INSERT_ROW_MENUE_DATA[e];else{let i=this.searchChildrenDomIndex(l.parentNode.parentNode);t=this.DATA[i][e]}let c=t.indexOf(r);if(-1!==c)return t.splice(c,1),o.classList.remove("option-active"),o.lastChild instanceof HTMLElement&&(o.lastChild.innerHTML=""),m(i,t,s),0===t.length&&(d.firstElementChild.textContent=n),void(!1===a&&(this.DATA_INPUT.value=JSON.stringify(this.DATA)));if(s>0&&t.length>=s)for(let e of h.childNodes)t.hasOwnProperty("0")&&e.getAttribute("data-id")===t[0].toString()&&e.click();o.classList.add("option-active"),t.push(r),o.lastChild instanceof HTMLElement&&o.lastChild.insertAdjacentHTML("afterbegin",p),m(i,t,s),!1===a&&(this.DATA_INPUT.value=JSON.stringify(this.DATA))}),!1),s>0&&t.length>=s&&t.slice(0,s),-1!==t.indexOf(parseInt(r))&&(o.classList.add("option-active"),o.lastChild instanceof HTMLElement&&o.lastChild.insertAdjacentHTML("afterbegin",p),m(i,t,s)),h.append(o)}function m(e,t,i){if(1===i)return void(d.firstElementChild.innerHTML=`<p class="dlp-text">${e[t[0]]}</p>`);let s="";for(let i of t)s+=`<span class="dlp-text" title="${e[i]}">${e[i]}</span>`;d.firstElementChild.innerHTML=s}return l.append(d),o.append(c),r.append(o),r.append(h),l.append(r),l.addEventListener("click",(()=>{r.style.display="flex"})),l.addEventListener("mouseleave",(()=>{r.style.display="none",this.DOM.querySelector(".dot-search").value=""})),l}sortable(){let e=this;new ComponentSortable(this.TBODY_DOM,(function(t){let i=[];t.forEach((function(t){i.push(e.DATA[t])})),e.DATA=i,e.DATA_INPUT.value=JSON.stringify(e.DATA)}))}datepicker(){"undefined"!=typeof jQuery&&setTimeout((()=>{for(let e in this.format_settings){let t=this.format_settings[e];$(`#${this.NAME} input.datetime-${e}`).datetimepicker({format:t,locale:"zh-CN"})}}))}searchChildrenDomIndex(e){let t=0;for(;null!=(e=e.previousSibling);)t++;return t}},window.ComponentPlane=class{constructor(e,t={},i={}){this.URL=e,this.XHR=Object.assign({url:e,method:"POST",listener:null,event:"click",callback:null},t),this.OPTIONS=Object.assign({w:.8,h:.8,top:"30px",left:"auto"},i),this.makeModal(),this.makeContent()}makeModal(){let e,t;e=-1!==this.OPTIONS.w.toString().indexOf(".")?window.innerWidth*this.OPTIONS.w+"px":this.OPTIONS.w,t=-1!==this.OPTIONS.h.toString().indexOf(".")?window.innerHeight*this.OPTIONS.h+"px":this.OPTIONS.h;let i=`<div id="dlp-plane" class="dlp-plane-gauze"><div style="width: ${e};margin: ${this.OPTIONS.top+" "+this.OPTIONS.left}"><div class="dlp plane-header"></div><div class="plane-body dlp-scroll" style="height:${t};"></div></div></div>`;document.body.insertAdjacentHTML("beforeEnd",i),this.DOM=document.getElementById("dlp-plane");let s=document.createElement("i");s.insertAdjacentHTML("afterbegin",_component.close),s.addEventListener("click",(()=>{this.DOM instanceof HTMLElement&&this.DOM.remove(),document.getElementById("kvFileinputModal")instanceof HTMLElement&&document.getElementById("kvFileinputModal").remove()}),!1),this.DOM.querySelector(".plane-header").append(s),this.MODEL_BODY_DOM=this.DOM.querySelector(".plane-body")}makeContent(){_component.loading(this.MODEL_BODY_DOM);let e=this;_component.request(this.URL,"GET",{},(function(t){_component.loading(e.MODEL_BODY_DOM,!0);let i=document.createRange().createContextualFragment(t);e.MODEL_BODY_DOM.appendChild(i);let s=e.XHR.listener;if("function"==typeof s){let t=s(e.MODEL_BODY_DOM);t instanceof HTMLElement&&t.addEventListener(e.XHR.event,e.submitEvent.bind(e,t),!1)}}))}submitEvent(e){e.setAttribute("disabled","disabled"),e.innerText="提交中...";let t=this.MODEL_BODY_DOM.getElementsByTagName("form")[0],i=new FormData(t);for(const e of i.entries()){let t=e[0],s=e[1];/\[.*\]/.test(t)&&/^\[.*\]$/.test(s)&&"string"==typeof s&&(s=JSON.parse(s),Array.isArray(s)&&s.length>0?s.forEach((e=>{i.append(`${t}[]`,e)})):i.append(`${t}`,""))}_component.request(this.XHR.url,this.XHR.method,i,(t=>{"function"!=typeof this.XHR.callback?t&&(0===t.code?window.location.reload():_component.alert(t.message,3,(function(){e.removeAttribute("disabled"),e.innerText="提交"}))):this.XHR.callback(t)}))}},window.ComponentSortable=class{constructor(e,t=null){this.list="string"==typeof e?document.querySelector(e):e,this.options={animationSpeed:200,animationEasing:"ease-out"},this.callback=t,this.animation=!1,this.dragStart=this.dragStart.bind(this),this.dragMove=this.dragMove.bind(this),this.dragEnd=this.dragEnd.bind(this),this.list.addEventListener("touchstart",this.dragStart,!1),this.list.addEventListener("mousedown",this.dragStart,!1)}reset(){this.items=Array.from(this.list.children),this.items[this.items.length-1].offsetTop>this.list.offsetHeight?this.listHeight=this.list.scrollHeight:this.listHeight=this.items[this.items.length-1].offsetTop}dragStart(e){if(this.reset(),this.animation)return;if(this.items.length<2)return;this.handle=null;let t=e.target;for(;t&&(t.hasAttribute("sortable-handle")&&(this.handle=t),t.hasAttribute("sortable-item")&&(this.item=t),!t.hasAttribute("sortable-list"));)t=t.parentElement;if(!this.handle)return;this.list.style.position="relative",this.item.classList.add("is-dragging"),this.itemHeight=this.items[1].offsetTop,this.startTouchY=this.getDragY(e),this.startTop=this.item.offsetTop;const i=this.items.map((e=>e.offsetTop));this.items.forEach(((e,t)=>{e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.transform=`translateY(${i[t]}px)`,e.style.zIndex=e===this.item?"2":"1"})),this.positions=this.items.map(((e,t)=>t)),this.position=Math.round(this.startTop/this.listHeight*this.items.length),this.touch="touchstart"===e.type,window.addEventListener(this.touch?"touchmove":"mousemove",this.dragMove),window.addEventListener(this.touch?"touchend":"mouseup",this.dragEnd,!1)}dragMove(e){if(this.animation)return;if(this.items.length<2)return;const t=this.startTop+this.getDragY(e)-this.startTouchY,i=Math.round(t/this.listHeight*this.items.length);this.item.style.transform=`translateY(${t}px)`,this.positions.forEach((e=>{e!==this.position&&e===i&&(this.swapElements(this.positions,this.position,e),this.position=e)})),this.items.forEach(((e,t)=>{e!==this.item&&(e.style.transform=`translateY(${this.positions.indexOf(t)*this.itemHeight}px)`,e.style.transition=`transform ${this.options.animationSpeed}ms ${this.options.animationEasing}`)})),e.preventDefault()}dragEnd(){this.animation=!0,this.items.length<2||(this.item.style.transition=`all ${this.options.animationSpeed}ms ${this.options.animationEasing}`,this.item.style.transform=`translateY(${this.position*this.itemHeight}px)`,this.item.classList.remove("is-dragging"),"function"==typeof this.callback&&this.callback(this.positions),setTimeout((()=>{this.list.style.position="",this.items.forEach((e=>{e.style.top="",e.style.left="",e.style.right="",e.style.position="",e.style.transform="",e.style.transition="",e.style.zIndex=""})),this.positions.map((e=>{this.items[e]&&this.list.appendChild(this.items[e])})),this.animation=!1}),this.options.animationSpeed),window.removeEventListener(this.touch?"touchmove":"mousemove",this.dragMove),window.removeEventListener(this.touch?"touchend":"mouseup",this.dragEnd,!1))}swapElements(e,t,i){let s=e[t];e[t]=e[i],e[i]=s}getDragY(e){return e.touches?(e.touches[0]||e.changedTouches[0]).pageY:e.pageY}},window.ComponentCascadeLine=class{constructor(e,t,i,s){if(!Array.isArray(t))return void console.error("CascadeLine param select must be array!");this.name=e,this.OPTIONS=Object.assign({movable:!0,exchange:!0,insert:!0,update:!0,delete:!0},s),this.DOM=document.getElementById(e),this.URL=i,this.make().makeSelect(t),this.OPTIONS.insert&&this.makeHeader();let n=document.querySelector(`#${this.name} .dot-search`);if(n.addEventListener("input",(()=>{setTimeout((()=>{this.search(n)}),700)})),this.OPTIONS.movable)for(let e of this.DOM.querySelectorAll("i.right"))this.nodeMigrate(e)}make(){return this.DOM.insertAdjacentHTML("afterbegin",'<div class="dlp dlp-dot dlp-cascadeLine"><div class="dot-top"><div class="search-box"><input type="text" class="dlp dot-search" placeholder="搜索名称"></div></div><div class="dot-body"><div class="dot-select dot-select-cascade" drag-area="true"></div></div></div>'),this.DOM.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.HEADER_DOM=document.querySelector(`#${this.name} .dot-top`),this.CONTENT_DOM=document.querySelector(`#${this.name} .dot-select`),this.SEARCH_BOX=document.querySelector(`#${this.name} .search-box`),this}makeHeader(){let e=document.createElement("div");e.className="dlp-btn",e.addEventListener("click",(()=>{this.panel("新增根节点");let e=this;_component.request(this.URL+"/create","GET",{},(function(t){e.panelContent(t,{key:0},e.URL,"POST",(t=>{if(void 0===t.data.key)return _component.alert("返回数据结构缺少key",3);if(void 0===t.data.val)return _component.alert("返回数据结构缺少val",3);let i=parseInt(t.data.key),s=t.data.val,n=e.dimensional_data[0].push({expand:!1,key:i,val:s,nodes:null,parentNodes:[]})-1,a=e.STACKS[0];a.append(e.insertLabelDom(e.dimensional_data[0][n],n,0)),e.STACKS[0].scrollTo(0,27*n),a.lastChild.click(),e.PLANE_DOM.remove()}))}))})),e.insertAdjacentHTML("afterbegin",_component.node),this.HEADER_DOM.append(e)}makeSelect(e){this.dimensional_data=[],_component.dimensional(this.dimensional_data,e);for(let e in this.dimensional_data){if(!this.dimensional_data.hasOwnProperty(e))continue;e=parseInt(e);let t=this.dimensional_data[e],i=document.createElement("div");i.className="dot-cascade-stack dlp-scroll",t.forEach(((t,s)=>{t.stack=e,Array.isArray(t.nodes)&&0!==t.nodes.length?(t.nodes=t.nodes.map((e=>e.key)),t.expand=!1):t.nodes=null;let n=this.insertLabelDom(t,s,e);null!==t.nodes&&n.insertAdjacentHTML("afterbegin",`<i class="left">${_component.caret_right}</i>`),i.append(n)})),this.CONTENT_DOM.append(i)}this.STACKS=this.CONTENT_DOM.childNodes}insertLabelDom(e,t,i){let s=document.createElement("div");return s.className="dlp dlp-text dlp-label",s.insertAdjacentHTML("afterbegin",`<span>${e.val}</span>`),s.setAttribute("data-id",e.key.toString()),s.setAttribute("data-k",t.toString()),s.setAttribute("data-stack",i.toString()),s.setAttribute("drag-zone","true"),s.addEventListener("click",this.select.bind(this,s,i)),s.addEventListener("contextmenu",(t=>{t.preventDefault(),t.target instanceof HTMLElement&&t.target.click();let n=[];this.OPTIONS.insert&&n.push({title:"新增",func:()=>{this.nodeInsert(s,e,i)}}),this.OPTIONS.update&&n.push({title:"修改",func:()=>{this.nodeUpdate(s,e)}}),this.OPTIONS.delete&&n.push({title:"删除",func:()=>{this.nodeDelete(s,e,i)}}),_component.contextmenu(t,n)})),this.OPTIONS.movable&&s.insertAdjacentHTML("afterbegin",`<i class="right">${_component.move}</i>`),s}select(e,t){let i=parseInt(e.getAttribute("data-k")),s=this.dimensional_data[t][i],n=this.STACKS[t].childNodes,a=s.parentNodes[s.parentNodes.length-1];if(this.dimensional_data[t].forEach(((e,t)=>{let i=n[t];-1!==e.parentNodes.indexOf(a)?i.classList.remove("dlp-label-silence"):i.classList.add("dlp-label-silence"),this.expand(e,n[t],!1)})),this.expand(s,e,!0),e.classList.remove("dlp-label-silence"),this.selectToChildren(t+1,s.nodes),Array.isArray(s.parentNodes)&&s.parentNodes.length>0){let e=s.parentNodes.slice(0);this.selectToParent(e)}}selectToParent(e){let t=e.length-1,i=e.pop(),s=e[t-1],n=this.STACKS[t].childNodes,a=null;this.dimensional_data[t].forEach(((e,l)=>{let d=n[l],r=e.parentNodes;r.length>0&&r[t-1]!==s||0===r.length&&parseInt(d.getAttribute("data-id"))!==i?(d.classList.add("dlp-label-silence"),this.expand(e,d,!1)):(d.classList.remove("dlp-label-silence"),parseInt(d.getAttribute("data-id"))===i?(null===a&&(a=l),this.expand(e,d,!0)):this.expand(e,d,!1))})),null!==a&&this.STACKS[t].scrollTo(0,27*a),e.length>0&&this.selectToParent(e)}selectToChildren(e,t){if(e>this.dimensional_data.length-1)return;let i=this.STACKS[e].childNodes,s=[],n=null;this.dimensional_data[e].forEach(((a,l)=>{let d=i[l];if(null!==t)if(-1!==t.indexOf(parseInt(d.getAttribute("data-id")))){d.classList.remove("dlp-label-silence");let t=this.dimensional_data[e][l].nodes;Array.isArray(t)&&t.forEach((e=>{-1===s.indexOf(t)&&s.push(e)})),null===n&&(n=l),this.expand(a,d,!0)}else d.classList.add("dlp-label-silence"),this.expand(a,d,!1);else d.classList.add("dlp-label-silence")})),null!==n&&this.STACKS[e].scrollTo(0,27*n),this.selectToChildren(e+1,s)}expand(e,t,i=!0){if(e.expand===i)return;e.expand=i;let s=t.querySelector("i.left");s instanceof HTMLElement&&(s.innerHTML=i?_component.caret_right_circle:_component.caret_right)}panel(e){this.DOM.childNodes[0].insertAdjacentHTML("beforeend",'<div class="dot-cascade-panel"><div class="dlp plane-header"></div><div class="plane-body dlp-scroll"></div></div>');let t=this.DOM.childNodes[0].lastChild,i=t.querySelector(".plane-header");this.PLANE_DOM=t;let s=document.createElement("div");s.className="header-content",s.insertAdjacentHTML("afterbegin",_component.node+` <span style="vertical-align: top;">${e}</span>`),i.append(s);let n=document.createElement("i");n.insertAdjacentHTML("afterbegin",_component.close),n.addEventListener("click",(()=>{t.remove()}),!1),i.append(n),this.PLANE_BODY=t.querySelector(".plane-body"),_component.loading(this.PLANE_BODY)}panelContent(e,t,i,s,n){_component.loading(this.PLANE_BODY,!0);let a=document.createRange().createContextualFragment(e);this.PLANE_BODY.appendChild(a);let l=document.createElement("div");if(l.insertAdjacentHTML("afterbegin",_component.check),l.addEventListener("click",this.submitEvent.bind(this,l,t,i,s,n)),l.className="dlp-submit-btn",!(this.PLANE_DOM instanceof HTMLElement))return;let d=this.PLANE_DOM.querySelector(".plane-header"),r=d.querySelector("i");d.insertBefore(l,r)}submitEvent(e,t,i,s,n){if(this.submit_block)return;this.submit_block=!0,e.innerHTML=_component.sub_loading;let a=this.DOM.getElementsByTagName("form")[0],l=new FormData(a);l.set("key",t.key),l.set("val",t.val),l.set("_method",s);let d=this;_component.request(i,"POST",l,(function(t){if(d.submit_block=!1,e.innerHTML=_component.check,0!==t.code)return _component.alert(t.message,3);n(t)}),(function(){d.submit_block=!1}))}nodeInsert(e,t,i){this.panel(`<span class="dlp-text title" title="${t.val}">${t.val}</span> 新增`);let s=this,n=parseInt(i)+1;_component.request(this.URL+"/create","GET",{id:t.key},(function(i){s.panelContent(i,t,s.URL,"POST",(i=>{if(0!==i.code)return _component.alert(i.message,3);if(void 0===i.data.key)return _component.alert("返回数据结构缺少key",3);if(void 0===i.data.val)return _component.alert("返回数据结构缺少val",3);let a=parseInt(i.data.key),l=i.data.val,d=t.parentNodes.slice(0);if(d.push(t.key),Array.isArray(s.dimensional_data[n]))if(Array.isArray(t.nodes)&&0!==t.nodes.length){let e=t.nodes[t.nodes.length-1],i=s.STACKS[n].childNodes,r=0;for(let t in s.dimensional_data[n])if(s.dimensional_data[n].hasOwnProperty(t)&&(t=parseInt(t),r=t+1,s.dimensional_data[n][t].key===e)){s.dimensional_data[n].splice(r,0,{expand:!1,key:a,val:l,nodes:null,parentNodes:d});let e=i[t];e.parentNode.insertBefore(s.insertLabelDom(s.dimensional_data[n][r],r,n),e.nextSibling);break}s.dimensional_data[n].forEach(((e,t)=>{t>r&&i[t].setAttribute("data-k",t)})),s.STACKS[n].scrollTo(0,27*r)}else{let t=s.dimensional_data[n].push({expand:!1,key:a,val:l,nodes:null,parentNodes:d})-1;s.STACKS[n].append(s.insertLabelDom(s.dimensional_data[n][t],t,n)),e.insertAdjacentHTML("afterbegin",`<i class="left">${_component.caret_right_circle}</i>`),s.STACKS[n].scrollTo(0,27*t)}else{s.dimensional_data[n]=[{expand:!1,key:a,val:l,nodes:null,parentNodes:d}];let t=document.createElement("div");t.className="dot-cascade-stack dlp-scroll",t.append(s.insertLabelDom(s.dimensional_data[n][0],0,n)),s.CONTENT_DOM.append(t),e.insertAdjacentHTML("afterbegin",`<i class="left">${_component.caret_right_circle}</i>`)}Array.isArray(t.nodes)||(t.nodes=[]),t.nodes.push(a),s.PLANE_DOM.remove()}))}))}nodeUpdate(e,t){this.panel(`<span class="dlp-text title" title="${t.val}">${t.val}</span> 修改`);let i=this;_component.request(this.URL+"/"+t.key+"/edit","GET",{val:t.val},(function(s){i.panelContent(s,t,i.URL+"/"+t.key,"PUT",(s=>{if(0!==s.code)return _component.alert(s.message,3);if(void 0===s.data.val)return _component.alert("返回数据结构缺少val",3);let n=s.data.val;t.val=n,e.querySelector("span").textContent=n,i.PLANE_DOM.remove()}))}))}dialog(e,t=50){let i=`<div class="dot-cascade-panel"><div class="dlp plane-header plane-header-dialog" style="margin-top: ${(this.DOM.clientHeight-(t+20))/2+"px"}"></div><div class="plane-body dlp-scroll plane-body-dialog" style="height:${t+"px"}"></div></div>`;this.DOM.childNodes[0].insertAdjacentHTML("beforeend",i);let s=this.DOM.childNodes[0].lastChild,n=s.querySelector(".plane-header"),a=document.createElement("div");a.className="header-content",a.insertAdjacentHTML("afterbegin",_component.node+`<span style="vertical-align: top;">${e}</span>`),n.append(a);let l=document.createElement("i");l.insertAdjacentHTML("afterbegin",_component.close),l.addEventListener("click",(()=>{s.remove()}),!1),n.append(l),this.PLANE_DOM=s,this.PLANE_BODY=s.querySelector(".plane-body")}nodeDelete(e,t,i){let s=this,n=`<span class="dlp-text title" title="${t.val}">${t.val}</span> 删除`;this.dialog(n);let a=document.createElement("div");a.className="dlp dlp-text dlp-label",a.addEventListener("click",(()=>{s.submit_block||(s.submit_block=!0,a.querySelector(".right").innerHTML=_component.sub_loading,_component.request(this.URL+"/"+t.key,"DELETE",{},(function(e){if(s.submit_block=!1,0!==e.code)return _component.alert(e.message,3);s.nodeDeleteExec(t,i),s.PLANE_DOM.remove()}),(function(){s.submit_block=!1})))})),a.insertAdjacentHTML("afterbegin",`<span>${t.val}</span><i class="right">${_component.trash}</i>`),this.PLANE_BODY.append(a)}nodeDeleteExec(e,t){let i,s=e.parentNodes.length-1;if(s>=0){let t=e.parentNodes.pop();for(let i in this.dimensional_data[s]){if(!this.dimensional_data[s].hasOwnProperty(i))continue;i=parseInt(i);let n=this.dimensional_data[s][i];if(n.key===t&&(n.nodes.forEach(((t,i)=>{t===e.key&&n.nodes.splice(i,1)})),0===n.nodes.length)){let e=this.STACKS[s].childNodes[i].querySelector("i.left");e&&e.remove()}}}for(let i=t+1;i<this.dimensional_data.length;i++){let t=[],s=[],n=0;for(let a in this.dimensional_data[i]){if(!this.dimensional_data[i].hasOwnProperty(a))continue;a=parseInt(a);let l=this.dimensional_data[i][a];-1===l.parentNodes.indexOf(e.key)?(this.STACKS[i].childNodes[a].setAttribute("data-k",n),n++,t.push(l)):s.push(this.STACKS[i].childNodes[a])}for(let e of s)e.remove();if(0===t.length){this.dimensional_data.splice(i,1),this.STACKS[i].remove();break}this.dimensional_data[i]=t}let n=!1,a=0;for(let s of this.STACKS[t].childNodes)parseInt(s.getAttribute("data-id"))!==e.key?(n&&s.setAttribute("data-k",a),a++):(n=!0,this.dimensional_data[t].splice(a,1),i=s);i.remove(),0===this.STACKS[t].childNodes.length&&(t>0?(this.STACKS[t].remove(),this.dimensional_data.splice(t,1)):this.dimensional_data=[[]])}search(e){if(Array.isArray(this.search_result)&&this.search_result.length>0&&this.lastPickRemove(),this.search_result=[],this.search_result_panel instanceof HTMLElement&&this.search_result_panel.remove(),""===e.value)return;if(this.dimensional_data.forEach(((t,i)=>{t.forEach(((t,s)=>{-1===t.val.indexOf(e.value)&&-1===e.value.indexOf(t.val)||this.search_result.push({stack:i,index:s})}))})),0===this.search_result.length)return;let t=document.createElement("div");t.className="dot-search-result-panel";let i=document.createElement("span");i.className="dlp-btn",i.textContent="◀",i.addEventListener("click",this.searchPick.bind(this,!1));let s=document.createElement("span");s.className="dlp-btn",s.textContent="▶",s.addEventListener("click",this.searchPick.bind(this,!0));let n=document.createElement("span");n.className="search-result-number dlp-text",n.textContent="1",this.SEARCH_PICK=n,this.search_result_pick=1,t.append(i),t.append(n),t.insertAdjacentHTML("beforeend",`<span> / </span><span class="search-result-number dlp-text">${this.search_result.length.toString()}</span>`),t.append(s),this.search_result_panel=t,this.SEARCH_BOX.append(t),this.pickUp()}searchPick(e=!0){this.lastPickRemove(),e?(this.search_result_pick++,this.search_result_pick>this.search_result.length&&(this.search_result_pick=1)):(this.search_result_pick--,this.search_result_pick<1&&(this.search_result_pick=this.search_result.length)),this.SEARCH_PICK.textContent=this.search_result_pick.toString(),this.pickUp()}lastPickRemove(){let e=this.search_result[this.search_result_pick-1];this.STACKS[e.stack].childNodes[e.index].classList.remove("dlp-label-active")}pickUp(){let e=this.search_result[this.search_result_pick-1],t=this.STACKS[e.stack].childNodes[e.index];t instanceof HTMLElement&&(t.classList.add("dlp-label-active"),this.STACKS[e.stack].scrollTo(0,27*e.index),t.click())}nodeMigrate(e){let t=e.parentNode,i=this,s=null;function n(e){e.preventDefault();let n=e.target;for(;null!==n&&n!==t&&(n instanceof HTMLElement||"svg"===n.tagName)&&"true"!==n.getAttribute("drag-area")&&"BODY"!==n.tagName;){if("true"===n.getAttribute("drag-zone")){if("dragover"===e.type)if(s=n,s.classList.contains("dlp-label-silence")&&s.click(),i.OPTIONS.exchange)s.style.setProperty("background","#bb8f2c");else{let e=parseInt(s.getAttribute("data-stack")),n=parseInt(s.getAttribute("data-k")),a=i.dimensional_data[e][n].parentNodes;Array.isArray(a)&&-1===a.indexOf(parseInt(t.getAttribute("data-id")))&&s.style.setProperty("background","#bb8f2c")}else"dragleave"===e.type&&s instanceof HTMLElement&&(s.style.removeProperty("background"),s=null);break}n=n.parentNode}}function a(){t.removeAttribute("draggable"),t.style.removeProperty("border"),t.removeEventListener("dragend",a),document.removeEventListener("dragover",n),document.removeEventListener("dragleave",n),s instanceof HTMLElement&&i.nodeMigrateConfirm(t,s)}e.addEventListener("mousedown",(()=>{t.click(),t.setAttribute("draggable","true"),t.style.setProperty("border","1px dashed #3c2d2d"),document.addEventListener("dragover",n),document.addEventListener("dragleave",n),t.addEventListener("dragend",a)})),e.addEventListener("mouseup",(()=>{e.parentNode.style.removeProperty("border"),document.removeEventListener("dragover",n),document.removeEventListener("dragleave",n),t.removeEventListener("dragend",a),s instanceof HTMLElement&&(s.style.removeProperty("background"),s=null)}))}nodeMigrateConfirm(e,t){let i,s=parseInt(t.getAttribute("data-stack")),n=parseInt(t.getAttribute("data-k")),a=this.dimensional_data[s][n];s=parseInt(e.getAttribute("data-stack")),n=parseInt(e.getAttribute("data-k"));let l=this.dimensional_data[s][n];if(i=-1!==a.parentNodes.indexOf(l.key)?"exchange":"migrate",!this.OPTIONS.exchange&&"exchange"===i)return;t.style.removeProperty("background"),this.dialog(`<span class="dlp-text title" title="${l.val}">${l.val}</span> 迁移`,90);let d=document.createElement("div"),r=this;d.className="dlp dlp-text dlp-label",d.insertAdjacentHTML("afterbegin",`<span>${l.val}</span><i class="right">${_component.check_circle}</i>`),this.PLANE_BODY.insertAdjacentHTML("afterbegin",`<div class="dlp dlp-text dlp-label"><span>${a.val}</span></div>`),"exchange"===i?this.PLANE_BODY.insertAdjacentHTML("beforeend",'<div style="font-size: 20px!important;">⇵</div>'):this.PLANE_BODY.insertAdjacentHTML("beforeend",'<div style="font-size: 18px!important;">↑</div>'),d.addEventListener("click",(()=>{r.submit_block||(r.submit_block=!0,d.querySelector(".right").innerHTML=_component.sub_loading,_component.request(this.URL,"GET",{event:i,node_key:l.key,node_val:l.val,aim_node_key:a.key,aim_node_val:a.val},(function(s){if(r.submit_block=!1,0!==(s=JSON.parse(s)).code)return _component.alert(s.message,3);"exchange"===i&&r.nodeExchangeExec(e,l,t,a),"migrate"===i&&r.nodeMigrateExec(e,l,t,a),r.PLANE_DOM.remove()}),(function(){r.submit_block=!1})))})),this.PLANE_BODY.append(d)}nodeMigrateExec(e,t,i,s){let n=s.parentNodes.slice(0);n.push(s.key),t.parentNodes=n;let a=s.stack+1,l=a-t.stack,d=parseInt(e.getAttribute("data-k"));this.dimensional_data[t.stack].splice(d,1),Array.isArray(this.dimensional_data[a])||(this.dimensional_data[a]=[]),this.dimensional_data[a].push(t),this.resetChildrenDimensional(t,t.stack+1,l),t.stack=a,Array.isArray(s.nodes)||(s.nodes=[]),s.nodes.push(t.key),this.CONTENT_DOM.innerHTML="";for(let e in this.dimensional_data){if(!this.dimensional_data.hasOwnProperty(e))continue;e=parseInt(e);let t=this.dimensional_data[e],i=document.createElement("div");i.className="dot-cascade-stack dlp-scroll",t.forEach(((t,s)=>{Array.isArray(t.nodes)&&0!==t.nodes.length?t.expand=!1:t.nodes=null;let n=this.insertLabelDom(t,s,e);null!==t.nodes&&n.insertAdjacentHTML("afterbegin",`<i class="left">${_component.caret_right}</i>`),i.append(n)})),this.CONTENT_DOM.append(i)}if(this.STACKS=this.CONTENT_DOM.childNodes,this.OPTIONS.movable)for(let e of this.DOM.querySelectorAll("i.right"))this.nodeMigrate(e)}nodeExchangeExec(e,t,i,s){let n=t.key,a=t.val;t.key=s.key,t.val=s.val;let l=t.nodes.indexOf(s.key);-1!==l&&t.nodes.splice(l,1,n);let d=t.parentNodes.slice(0).pop();if(void 0!==d)for(let e in this.dimensional_data[t.stack-1]){if(!this.dimensional_data[t.stack-1].hasOwnProperty(e))continue;let i=this.dimensional_data[t.stack-1][e];if(i.key===d){i.nodes.splice(i.nodes.indexOf(n),1,s.key);break}}s.key=n,s.val=a;let r=s.parentNodes.slice(0).pop();for(let e in this.dimensional_data[s.stack-1]){if(!this.dimensional_data[s.stack-1].hasOwnProperty(e))continue;let i=this.dimensional_data[s.stack-1][e];if(i.key===r){i.nodes.splice(i.nodes.indexOf(t.key),1,s.key);break}}this.resetChildrenParent(t),e.querySelector("span").textContent=t.val,e.setAttribute("data-id",t.key),i.querySelector("span").textContent=s.val,i.setAttribute("data-id",s.key)}resetChildrenParent(e){let t=e.stack,i=e.nodes,s=e.parentNodes.slice(0);s.push(e.key),t++,this.dimensional_data[t].forEach((e=>{-1!==i.indexOf(e.key)&&(e.parentNodes=s,Array.isArray(e.nodes)&&e.nodes.length>0&&this.resetChildrenParent(e))}))}resetChildrenDimensional(e,t,i){let s=e.nodes,n=e.parentNodes.slice(0);if(n.push(e.key),!Array.isArray(this.dimensional_data[t]))return;let a=[];this.dimensional_data[t].forEach(((e,l)=>{Array.isArray(s)&&-1!==s.indexOf(e.key)&&(a.push(l),e.parentNodes=n,e.stack=t+i,Array.isArray(this.dimensional_data[e.stack])||(this.dimensional_data[e.stack]=[]),this.dimensional_data[e.stack].push(e),this.resetChildrenDimensional(e,t+1,i))})),a.reverse(),a.forEach((e=>{this.dimensional_data[t].splice(e,1)}))}};