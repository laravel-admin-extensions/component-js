window._component={trash:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">\n  <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>\n  <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>\n</svg>',move:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">\n  <path d="M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>\n</svg>',write:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">\n  <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>\n  <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>\n</svg>',close:'<svg style="vertical-align: middle;" width="16" height="16" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill="none" stroke="white" stroke-width="2.5" d="M16,16 L4,4"></path><path fill="none" stroke="white" stroke-width="2.5" d="M16,4 L4,16"></path></svg>',aspect:'<svg xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle;" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">\n  <path fill="#ffffff" d="M0 12.5v-9A1.5 1.5 0 0 1 1.5 2h13A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 12.5zM2.5 4a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 1 0V5h2.5a.5.5 0 0 0 0-1h-3zm11 8a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-1 0V11h-2.5a.5.5 0 0 0 0 1h3z"/>\n</svg>',check:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">\n  <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>\n</svg>',check_circle:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">\n  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>\n  <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>\n</svg>',caret_right:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">\n  <path d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"/>\n</svg>',caret_right_circle:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">\n  <path d="M6 12.796V3.204L11.481 8 6 12.796zm.659.753 5.48-4.796a1 1 0 0 0 0-1.506L6.66 2.451C6.011 1.885 5 2.345 5 3.204v9.592a1 1 0 0 0 1.659.753z"/>\n</svg>',sub_loading:'<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="16px" height="16px" viewBox="0 0 50 50" style="background: rgb(223 9 127);border-radius: 50%;" xml:space="preserve">\n  <path fill="#ffffff" stroke="#ffffff" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z">\n    <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform>\n    </path>\n  </svg>',node:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-diagram-3-fill" viewBox="0 0 16 16">\n  <path fill-rule="evenodd" d="M6 3.5A1.5 1.5 0 0 1 7.5 2h1A1.5 1.5 0 0 1 10 3.5v1A1.5 1.5 0 0 1 8.5 6v1H14a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0v-1A.5.5 0 0 1 2 7h5.5V6A1.5 1.5 0 0 1 6 4.5v-1zm-6 8A1.5 1.5 0 0 1 1.5 10h1A1.5 1.5 0 0 1 4 11.5v1A1.5 1.5 0 0 1 2.5 14h-1A1.5 1.5 0 0 1 0 12.5v-1zm6 0A1.5 1.5 0 0 1 7.5 10h1a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 8.5 14h-1A1.5 1.5 0 0 1 6 12.5v-1zm6 0a1.5 1.5 0 0 1 1.5-1.5h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5v-1z"/>\n</svg>',request:function(t){t=Object.assign({url:"",method:"GET",header:{},data:{},callback:null,error_callback:null,timeout:3e4},t);let e=new XMLHttpRequest;"GET"===t.method&&(t.url=_component.parseParams(t.url,t.data)),e.open(t.method,t.url,!0),e.timeout=t.timeout;let i="";if(document.querySelector('meta[name="csrf-token"]')&&(i=document.querySelector('meta[name="csrf-token"]').getAttribute("content")),e.setRequestHeader("X-CSRF-TOKEN",i),t.header)for(let i in t.header)t.header.hasOwnProperty(i)&&e.setRequestHeader(i,t.header[i]);"GET"===t.method?(e.setRequestHeader("Content-type","application/text;charset=UTF-8"),e.responseType="text",e.send(null)):(t.data instanceof FormData?e.setRequestHeader("X-Requested-With","XMLHttpRequest"):(e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.data=JSON.stringify(t.data)),e.responseType="json",e.send(t.data)),e.onload=function(){this.status>=200&&this.status<300||"function"==typeof t.error_callback&&t.error_callback()},e.onreadystatechange=function(){if(e.readyState===e.DONE&&200===e.status){let i=e.response;"function"==typeof t.callback&&t.callback(i)}},e.onerror=function(e){console.error(e),"function"==typeof t.error_callback&&t.error_callback(e)}},parseParams(t,e){let i=[];return 0===Object.keys(e).length||(Object.keys(e).forEach((t=>e[t]&&i.push(`${t}=${e[t]}`))),-1===t.search(/\?/)?t+=`?${i.join("&")}`:t+=`&${i.join("&")}`),t},loading:function(t,e=!1){e?t.querySelector("div.dlp-loader").remove():t.insertAdjacentHTML("afterbegin",'<div class="dlp-loader">\n        <div class="dlp-loader-inner">\n            <div class="dlp-loader-line-wrap"><div class="dlp-loader-line"></div></div>\n            <div class="dlp-loader-line-wrap"><div class="dlp-loader-line"></div></div>\n            <div class="dlp-loader-line-wrap"><div class="dlp-loader-line"></div></div>\n            <div class="dlp-loader-line-wrap"><div class="dlp-loader-line"></div></div>\n            <div class="dlp-loader-line-wrap"><div class="dlp-loader-line"></div></div>\n        </div></div>')},_alert_documents:[],alert:function(t,e=1,i=null,s=null){let n,a,l=document.createElement("div");l.insertAdjacentHTML("afterbegin",`<span class="dlp dlp-text">${t}</span>`),l.className="dlp-alert",this._alert_documents.forEach((t=>{t.style.top=parseInt(t.style.top)-60+"px"})),this._alert_documents.push(l),s?s.append(l):document.getElementsByTagName("BODY")[0].appendChild(l),s?(n=(s.offsetWidth-320)/2,a=s.offsetHeight/2-15,l.style.position="absolute"):(n=(window.innerWidth-320)/2,a=window.innerHeight/2-15,l.style.position="fixed"),l.style.top=a+"px",l.style.left=n+"px",setTimeout((()=>{let t=this._alert_documents.shift();t.parentNode.removeChild(t),"function"==typeof i&&i()}),1e3*e)},contextmenu:function(t,e,i={}){i=Object.assign({W:"70px"},i);let s=document.createElement("ul");s.className="dlp dlp-contextmenu",e.forEach((t=>{let e=document.createElement("li");e.className="dlp dlp-text",e.insertAdjacentHTML("afterbegin",t.title),e.style.width=i.W,"function"==typeof t.func&&(e.addEventListener("click",(()=>{s.remove(),setTimeout((()=>{t.func()}),100)})),s.append(e))})),s.style.top=t.pageY-3+"px",s.style.left=t.pageX-3+"px",s.addEventListener("contextmenu",(t=>{t.preventDefault()})),s.addEventListener("mouseleave",(()=>{s.remove()})),document.getElementsByTagName("BODY")[0].appendChild(s)},dimensional(t,e,i=0,s=[]){if(Array.isArray(e)){for(let n in e){if(!e.hasOwnProperty(n))continue;let a=s.slice(0);a.push(e[n].key),_component.dimensional(t,e[n],i,a)}return}let n=s.slice(0);n.pop(),e.parentNodes=n,Array.isArray(t[i])?t[i].push(e):t[i]=[e],e.hasOwnProperty("nodes")&&Array.isArray(e.nodes)&&0!==e.nodes.length&&(i++,_component.dimensional(t,e.nodes,i,s))},imgDelay(t,e={time:200,zoom:!1,width:300,height:0}){let i;if("string"==typeof t)i=document.querySelectorAll(t);else{if(!(Array.isArray(t)&&t[0]instanceof HTMLElement))return void console.error("type of selector is error!");i=t}e=Object.assign({time:200,zoom:!1,width:300,height:0},e);let s=0;for(let t of i)setTimeout((()=>{let i=t.getAttribute("data-src");t.setAttribute("src",i),t.onload=function(){if(!e.zoom)return;let s=document.createElement("img");t.addEventListener("mouseover",(function(t){document.body.append(s),s.style.position="absolute",s.style.zIndex="1000000",s.style.borderRadius="3px",s.setAttribute("src",i);let n=s.naturalWidth,a=s.naturalHeight;0!==e.width&&(n=e.width,a=s.naturalHeight*(e.width/s.naturalWidth)),e.height>0?a=e.height:e.height<0&&s.naturalHeight>window.innerHeight&&(a=window.innerHeight-10,n=s.naturalWidth*(a/s.naturalHeight)),s.style.width=`${n}px`,s.style.height=`${a}px`;let l=a/2;s.style.top=t.pageY-l+"px";let r=window.innerHeight-t.clientY;window.innerHeight-t.clientY<l+5?s.style.top=t.pageY-(l+(l-r)+5)+"px":t.clientY<l-5&&(s.style.top=t.pageY-(l-(l-t.clientY)-5)+"px"),window.innerWidth-t.clientX<n?s.style.left=t.pageX-n-30+"px":s.style.left=`${t.pageX+25}px`})),t.addEventListener("mouseout",(function(t){t.stopPropagation(),s.remove()}))}}),s*e.time),s++}},window.ComponentDot=class{MODE={insert:"insert",delete:"delete"};constructor(t,e){if(!Array.isArray(e)&&"object"==typeof e)return this.select=e,this.limit=0,t instanceof HTMLElement?this.DOM=t:this.DOM=document.querySelector(t),this.DOM.addEventListener("contextmenu",(t=>{t.preventDefault()})),this.selected_data=[],this.select_data=[],this.insert_data=[],this.delete_data=[],this._modSettings={mode:!1},this._useSearchMod=!1,this._triggerEvent={func:null,enable:!1},this._tagSelect=function(t){this.limit>0&&this.select_data.length>=this.limit&&this.SELECTED_DOM.firstChild instanceof HTMLElement&&(this._triggerEvent.enable=!1,this.SELECTED_DOM.firstChild.click(),this._triggerEvent.enable=!0);let e=t.cloneNode(!0);e.addEventListener("click",(()=>this._tagCancel(e)),!1),this.SELECTED_DOM.appendChild(e),t.remove(),this._tagCal(t.getAttribute("data-id"),this.MODE.insert),this.SELECTED_DOM.scrollTop=this.SELECTED_DOM.scrollHeight},this._tagCancel=function(t){let e=t.cloneNode(!0);e.addEventListener("click",(()=>this._tagSelect(e)),!1),this.CONTENT_DOM.appendChild(e),t.remove(),this._tagCal(t.getAttribute("data-id"),this.MODE.delete)},this._tagCal=function(t,e){let i=this.select_data.indexOf(t);e===this.MODE.insert?(-1===i&&(this.select_data.push(t),this.selectInputDOM instanceof HTMLElement&&(this.selectInputDOM.value=JSON.stringify(this.select_data))),-1===this.selected_data.indexOf(t)&&-1===this.insert_data.indexOf(t)&&(this.insert_data.push(t),this.selectInputDOM instanceof HTMLElement&&(this.insertInputDOM.value=JSON.stringify(this.insert_data))),i=this.delete_data.indexOf(t),-1!==i&&(this.delete_data.splice(i,1),this.deleteInputDOM instanceof HTMLElement&&(this.deleteInputDOM.value=JSON.stringify(this.delete_data)))):(-1!==i&&(this.select_data.splice(i,1),this.selectInputDOM instanceof HTMLElement&&(this.selectInputDOM.value=JSON.stringify(this.select_data))),-1!==this.selected_data.indexOf(t)&&-1===this.delete_data.indexOf(t)&&(this.delete_data.push(t),this.deleteInputDOM instanceof HTMLElement&&(this.deleteInputDOM.value=JSON.stringify(this.delete_data))),i=this.insert_data.indexOf(t),-1!==i&&(this.insert_data.splice(i,1),this.insertInputDOM instanceof HTMLElement&&(this.insertInputDOM.value=JSON.stringify(this.insert_data)))),"function"==typeof this._triggerEvent.func&&!0===this._triggerEvent.enable&&this._triggerEvent.func(this.select_data,this.insert_data,this.delete_data)},this._search=function(t){if("menu"===this._modSettings.mode){if(""===t.value){for(let t of this.CONTENT_DOM.childNodes)t.style.display="flex";return}for(let e in this.select){if(!this.select.hasOwnProperty(e))continue;let i=this.select[e],s=this.id_line_hash[e];-1!==i.indexOf(t.value)||-1!==t.value.indexOf(i)?this.CONTENT_DOM.childNodes[s].style.display="flex":this.CONTENT_DOM.childNodes[s].style.display="none"}return}if(""===t.value){if(this.SELECT_COVER_DOM instanceof HTMLElement){let t=[];this.SELECT_COVER_DOM.childNodes.forEach((e=>{t.push(e)})),this.CONTENT_DOM.append(...t),this.SELECT_COVER_DOM.remove(),this.SELECT_COVER_DOM=null}return}if(this.SELECT_COVER_DOM instanceof HTMLElement){let t=[];this.SELECT_COVER_DOM.childNodes.forEach((e=>{t.push(e)})),this.CONTENT_DOM.append(...t)}else this.SELECT_COVER_DOM=document.createElement("div"),this.SELECT_COVER_DOM.className="dot-select dlp-scroll dot-select-cover",this.CONTENT_DOM.parentNode.appendChild(this.SELECT_COVER_DOM);let e=[];for(let i of this.CONTENT_DOM.childNodes)-1!==i.className.indexOf("dlp-label")&&(-1===i.innerText.indexOf(t.value)&&-1===t.value.indexOf(i.innerText)||e.push(i));this.SELECT_COVER_DOM.append(...e)},this._menuSelect=function(t){if(1===this.limit)return void(this.SELECTED_DOM.innerHTML=`<p class="dlp-text">${t[this.select_data[0]]}</p>`);let e="";for(let i of this.select_data)e+=`<span class="dlp-text" title="${t[i]}">${t[i]}</span>`;this.SELECTED_DOM.innerHTML=e},this._bind=function(){if(this.CONTENT_DOM.childNodes.forEach((t=>{let e=t.getAttribute("data-id");-1!==this.selected_data.indexOf(e)&&(this._triggerEvent.enable=!1,t.click(),this._triggerEvent.enable=!0)})),"menu"===this._modSettings.mode&&(this.DOM.querySelector(".menu-list").style.display="none"),!1===this._useSearchMod)return;let t=this.DOM.querySelector(".dot-search");t.addEventListener("input",(()=>{setTimeout((()=>{this._search(t)}),500)}))},this._menuMaker=function(){let t=this.select,e=document.createElement("div");e.className="dlp-dot-menu";let i=document.createElement("div");i.className="dlp-input dlp-dot-menu-select",i.insertAdjacentHTML("afterbegin",`<div class="dlp dlp-text">${this._modSettings.placeholder}</div><div>▼</div>`);let s=document.createElement("div");s.className="menu-list";let n=document.createElement("div");n.className="list dlp-scroll",n.style.maxHeight=this._modSettings.height;let a=_component.check;this.id_line_hash=[];let l=0;for(let e in t){if(!t.hasOwnProperty(e))continue;this.id_line_hash[e]=l,l++;let i=document.createElement("div");i.className="option",i.setAttribute("data-id",e),i.insertAdjacentHTML("afterbegin",`<div class="dlp dlp-text" data-v="${e}">${t[e]}</div><div></div>`),i.addEventListener("click",(()=>{if(-1!==this.select_data.indexOf(e))return this._tagCal(e,this.MODE.delete),i.classList.remove("option-active"),i.lastChild instanceof HTMLElement&&(i.lastChild.innerHTML=""),this._menuSelect(t),void(0===this.select_data.length&&(this.SELECTED_DOM.textContent=this._modSettings.placeholder));this.limit>0&&this.select_data.length>=this.limit&&(this._triggerEvent.enable=!1,n.childNodes[this.id_line_hash[this.select_data[0].toString()]].click(),this._triggerEvent.enable=!0),i.classList.add("option-active"),this._tagCal(e,this.MODE.insert),i.lastChild instanceof HTMLElement&&i.lastChild.insertAdjacentHTML("afterbegin",a),this._menuSelect(t)}),!1),n.append(i)}if(e.append(i),!0===this._useSearchMod){let t=document.createElement("div");t.className="search-box";let e=document.createElement("input");e.className="dlp dlp-input dot-search",e.setAttribute("placeholder","搜索"),t.append(e),s.append(t)}s.append(n),e.append(s),e.addEventListener("click",(()=>{s.style.display="flex","up"===this._modSettings.direction?(s.style.top=`-${s.clientHeight+2.5}px`,s.style.flexDirection="column-reverse"):"middle"===this._modSettings.direction&&(s.style.top=`-${s.clientHeight/2}px`)})),e.addEventListener("mouseleave",(()=>{s.style.display="none",!0===this._useSearchMod&&(this.DOM.querySelector(".dot-search").value="");for(let t of this.CONTENT_DOM.childNodes)t.style.display="flex"})),this.DOM.append(e),this.SELECTED_DOM=this.DOM.querySelector(".dlp-dot-menu-select").firstElementChild,this.CONTENT_DOM=this.DOM.querySelector(".list")},this._switchMaker=function(){let t=this.select,e=document.createElement("div");e.className="dlp dlp-dot-switch",this.id_line_hash=[];let i=0;for(let s in t){if(!t.hasOwnProperty(s))continue;this.id_line_hash[s]=i,i++;let n=document.createElement("div");n.setAttribute("data-id",s),n.className=`dlp dlp-button${this._modSettings.color}`,n.textContent=t[s],n.addEventListener("click",(()=>{if(-1!==this.select_data.indexOf(s))return this._tagCal(s,this.MODE.delete),n.classList.remove(`dlp-button${this._modSettings.color}-active`),void n.classList.add(`dlp-button${this._modSettings.color}`);this.limit>0&&this.select_data.length>=this.limit&&(this._triggerEvent.enable=!1,e.childNodes[this.id_line_hash[this.select_data[0].toString()]].click(),this._triggerEvent.enable=!0),n.classList.remove(`dlp-button${this._modSettings.color}`),n.classList.add(`dlp-button${this._modSettings.color}-active`),this._tagCal(s,this.MODE.insert)}),!1),e.append(n)}this.DOM.append(e),this.CONTENT_DOM=e},this;console.error("Dot param select must be object such as {key:val,key2:val2,...} !")}selected(t){return Array.isArray(t)?(t=(t=t.map((function(t){return t.toString()}))).filter((t=>void 0!==this.select[t])),this.selected_data=t,this):(console.error("Dot param selected must be array [key1,key2...]!"),this)}limitNum(t){return this.limit=t,this}menuMod(t={placeholder:"未选择",height:"150px",direction:"down"}){return this._modSettings=Object.assign({placeholder:"未选择",height:"150px",direction:"down"},t),this._modSettings.mode="menu",this}switchMod(t={color:""}){switch(this._modSettings=Object.assign({color:""},t),this._modSettings.mode="switch",this._modSettings.color){case"red":case"blue":case"green":case"yellow":this._modSettings.color="-"+this._modSettings.color;break;default:this._modSettings.color=""}return this}useSearch(){return this._useSearchMod=!0,this}trigger(t=function(){}){return this._triggerEvent={func:t,enable:!0},this}useHiddenInput(t){return this.DOM.insertAdjacentHTML("beforeend",`<input name="${t}[select]" value="[]" type="hidden" /><input name="${t}[insert]" value="[]" type="hidden" /><input name="${t}[delete]" value="[]" type="hidden" />`),this.selectInputDOM=this.DOM.querySelector(`input[name='${t}[select]']`),this.insertInputDOM=this.DOM.querySelector(`input[name='${t}[insert]']`),this.deleteInputDOM=this.DOM.querySelector(`input[name='${t}[delete]']`),this}make(){if("menu"===this._modSettings.mode)this._menuMaker();else if("switch"===this._modSettings.mode)this._switchMaker(),this._useSearchMod=!1;else{let t=this.select,e="";for(let i in t)t.hasOwnProperty(i)&&(e+=`<div class="dlp dlp-label dlp-text" data-id="${i}" title="${t[i]}"><span>${t[i]}</span></div>`);let i="";this._useSearchMod&&(i='<input type="text" class="dlp dot-search" placeholder="搜索名称">');let s=`<div class="dlp dlp-dot" ><div class="dot-top">${i}<div class="dot-selected dlp-scroll"></div></div><div class="dot-body"><div class="dot-select dlp-scroll">${e}</div></div></div>`;this.DOM.insertAdjacentHTML("afterbegin",s),this.SELECTED_DOM=this.DOM.querySelector(".dot-selected"),this.CONTENT_DOM=this.DOM.querySelector(".dot-select");for(let t of this.CONTENT_DOM.getElementsByClassName("dlp-label"))t.addEventListener("click",(()=>this._tagSelect(t)),!1)}this._bind()}},window.ComponentCascadeDot=class{MODE={insert:"insert",delete:"delete"};constructor(t,e){Array.isArray(e)&&"object"==typeof e[0]?(t instanceof HTMLElement?this.DOM=t:this.DOM=document.querySelector(t),this._triggerEvent={func:null,enable:!1},this.limit=0,this.select=e,this.selected_data=[],this.select_data=[],this.insert_data=[],this.delete_data=[],this._makeSelect=function(t){this.dimensional_data=[],this.selected_label_dom=[],_component.dimensional(this.dimensional_data,t);let e=this;for(let t in this.dimensional_data){if(!this.dimensional_data.hasOwnProperty(t))continue;t=parseInt(t);let i=this.dimensional_data[t],s=document.createElement("div");s.className="dot-cascade-stack dlp-scroll",i.forEach(((i,n)=>{Array.isArray(i.nodes)&&0!==i.nodes.length?i.nodes=i.nodes.map((t=>t.key)):(i.nodes=null,i.checked=!1);let a=document.createElement("div");a.className="dlp dlp-text dlp-label",a.insertAdjacentHTML("afterbegin",`<i class="left"></i><span>${i.val}</span><i class="right"></i>`),a.setAttribute("data-id",i.key),a.setAttribute("data-k",n),a.addEventListener("click",this._select.bind(this,a,t)),null!==i.nodes?(a.querySelector("i.left").insertAdjacentHTML("afterbegin",`${_component.caret_right}`),a.addEventListener("contextmenu",(i=>{i.target instanceof HTMLElement&&i.target.click(),i.preventDefault();let s=parseInt(a.getAttribute("data-k"));_component.contextmenu(i,[{title:"全选",func:()=>{e._checkAll(t+1,this.dimensional_data[t][s].nodes,!0),i.target instanceof HTMLElement&&i.target.click()}},{title:"取消",func:()=>{e._checkAll(t+1,this.dimensional_data[t][s].nodes,!1)}}])}))):a.addEventListener("contextmenu",(t=>{t.preventDefault()})),s.append(a);let l=this.selected_data.indexOf(parseInt(i.key));!1===i.checked||-1===l?-1!==l&&this.selected_label_dom.push(a):this.selected_data.splice(l,1)})),this.CONTENT_DOM.append(s)}this.STACKS=this.CONTENT_DOM.childNodes},this._select=function(t,e){let i=parseInt(t.getAttribute("data-k")),s=this.dimensional_data[e][i],n=this.STACKS[e].childNodes,a=s.parentNodes[s.parentNodes.length-1];if(!0===s.checked){s.checked=!1,this._tagCal(s.key,this.MODE.delete),null===s.nodes&&(t.querySelector("i.right").innerHTML="");for(let t of this.SELECTED_DOM.childNodes)if(parseInt(t.getAttribute("data-id"))===s.key){t.remove();break}}else this.dimensional_data[e].forEach(((t,e)=>{-1!==t.parentNodes.indexOf(a)?n[e].classList.remove("dlp-label-silence"):n[e].classList.add("dlp-label-silence")})),!1===s.checked?(this.limit>0&&this.select_data.length>=this.limit&&this.SELECTED_DOM.firstChild instanceof HTMLElement&&(this._triggerEvent.enable=!1,this.SELECTED_DOM.firstChild.click(),this._triggerEvent.enable=!0),s.checked=!0,this._tagCal(s.key,this.MODE.insert),t.classList.remove("dlp-label-silence"),t.querySelector("i.right").insertAdjacentHTML("afterbegin",_component.check),this._selectToChildren(e+1,s.nodes),this._selectToSelected(t,e),this.SELECTED_DOM.scrollTop=this.SELECTED_DOM.scrollHeight):(t.classList.remove("dlp-label-silence"),this._selectToChildren(e+1,s.nodes));if(Array.isArray(s.parentNodes)&&s.parentNodes.length>0){let t=s.parentNodes.slice(0);this._selectToParent(t,s.checked)}},this._selectToSelected=function(t,e){let i=document.createElement("div");i.className="dlp dlp-text dlp-label",i.setAttribute("data-id",t.getAttribute("data-id")),i.setAttribute("stack",e),i.insertAdjacentHTML("afterbegin",`<span>${t.querySelector("span").textContent}</span>`),i.addEventListener("click",(()=>{this._select(t,e)})),this.SELECTED_DOM.append(i)},this._selectToParent=function(t,e){let i=t.length-1,s=t.pop(),n=t[i-1],a=this.STACKS[i].childNodes,l=null;this.dimensional_data[i].forEach(((t,r)=>{let d=a[r],o=t.parentNodes;if(!0!==e&&void 0!==e||(o.length>0&&o[i-1]!==n||0===o.length&&parseInt(d.getAttribute("data-id"))!==s?d.classList.add("dlp-label-silence"):(d.classList.remove("dlp-label-silence"),parseInt(d.getAttribute("data-id"))===s&&null===l&&(l=r))),!0===e&&s===t.key&&!0!==t.mark&&(t.mark=!0,d.querySelector(".right").insertAdjacentHTML("afterbegin",_component.check_circle)),!1===e&&s===t.key){let e=this.dimensional_data[i][r].nodes,s=!0;for(let t of this.dimensional_data[i+1])if(-1!==e.indexOf(t.key)&&(!0===t.checked||!0===t.mark)){s=!1;break}s&&(t.mark=!1,d.querySelector("i.right").innerHTML="")}})),null!==l&&this.STACKS[i].scrollTo(0,27*l),t.length>0&&this._selectToParent(t,e)},this._selectToChildren=function(t,e){if(t>this.dimensional_data.length-1)return;let i=this.STACKS[t].childNodes,s=[],n=null;this.dimensional_data[t].forEach(((t,a)=>{let l=i[a];if(null!==e)if(-1!==e.indexOf(parseInt(l.getAttribute("data-id")))){l.classList.remove("dlp-label-silence");let e=t.nodes;Array.isArray(e)&&e.forEach((t=>{-1===s.indexOf(e)&&s.push(t)})),null===n&&(n=a)}else l.classList.add("dlp-label-silence");else l.classList.add("dlp-label-silence")})),null!==n&&this.STACKS[t].scrollTo(0,27*n),this._selectToChildren(t+1,s)},this._tagCal=function(t,e){if(e===this.MODE.insert){-1===this.select_data.indexOf(t)&&(this.select_data.push(t),this.selectInputDOM instanceof HTMLElement&&(this.selectInputDOM.value=JSON.stringify(this.select_data))),-1===this.selected_data.indexOf(t)&&-1===this.insert_data.indexOf(t)&&(this.insert_data.push(t),this.insertInputDOM instanceof HTMLElement&&(this.insertInputDOM.value=JSON.stringify(this.insert_data)));let e=this.delete_data.indexOf(t);-1!==e&&(this.delete_data.splice(e,1),this.deleteInputDOM instanceof HTMLElement&&(this.deleteInputDOM.value=JSON.stringify(this.delete_data)))}else if(e===this.MODE.delete){let e=this.select_data.indexOf(t);-1!==e&&(this.select_data.splice(e,1),this.selectInputDOM instanceof HTMLElement&&(this.selectInputDOM.value=JSON.stringify(this.select_data))),-1!==this.selected_data.indexOf(t)&&-1===this.delete_data.indexOf(t)&&(this.delete_data.push(t),this.deleteInputDOM instanceof HTMLElement&&(this.deleteInputDOM.value=JSON.stringify(this.delete_data))),e=this.insert_data.indexOf(t),-1!==e&&(this.insert_data.splice(e,1),this.insertInputDOM instanceof HTMLElement&&(this.insertInputDOM.value=JSON.stringify(this.insert_data)))}"function"==typeof this._triggerEvent.func&&!0===this._triggerEvent.enable&&this._triggerEvent.func(this.select_data,this.insert_data,this.delete_data)},this._search=function(t){if(""!==t.value){if(!(this.SELECT_COVER_DOM instanceof HTMLElement)){this.COVER_STACK_HASH_DOM=[],this.SELECT_COVER_DOM=document.createElement("div"),this.SELECT_COVER_DOM.className="dot-select-cover dlp-scroll dot-select-cascade";for(let t=1;t<=this.dimensional_data.length;t++){let t=document.createElement("div");t.className="dot-cascade-stack dlp-scroll",this.SELECT_COVER_DOM.append(t)}this.CONTENT_DOM.parentNode.append(this.SELECT_COVER_DOM)}this.dimensional_data.forEach(((e,i)=>{this._searchPushTag(t,e,i)}))}else this.SELECT_COVER_DOM instanceof HTMLElement&&(this.SELECT_COVER_DOM.remove(),this.SELECT_COVER_DOM=null,this.COVER_STACK_HASH_DOM=[])},this._searchCoverClick=function(t,e,i){if(null===e.nodes)i instanceof HTMLElement&&i.click();else{let i=t+1;Array.isArray(this.dimensional_data[i])&&this._searchPushTag(e.nodes,this.dimensional_data[i],i)}},this._searchPushTag=function(t,e,i){e.forEach(((e,s)=>{if(Array.isArray(t)){if(-1===t.indexOf(e.key))return}else if(-1===e.val.indexOf(t.value)&&-1===t.value.indexOf(e.val))return;if(Array.isArray(this.COVER_STACK_HASH_DOM[i])&&-1!==this.COVER_STACK_HASH_DOM[i].indexOf(e.key))return;let n=document.createElement("div");n.className="dlp dlp-text dlp-label",n.insertAdjacentHTML("afterbegin",`<i class="left"></i><span>${e.val}</span><i class="right"></i>`),null!==e.nodes&&n.querySelector("i.left").insertAdjacentHTML("afterbegin",_component.caret_right),n.addEventListener("click",(()=>this._searchCoverClick(i,e,this.STACKS[i].childNodes[s]))),this.SELECT_COVER_DOM.childNodes[i].prepend(n),Array.isArray(this.COVER_STACK_HASH_DOM[i])?this.COVER_STACK_HASH_DOM[i].push(e.key):this.COVER_STACK_HASH_DOM[i]=[e.key]}))},this._checkAll=function(t,e,i){if(t>this.dimensional_data.length-1)return;if(!Array.isArray(e)||e.length<=0)return;let s=this.STACKS[t].childNodes,n=[],a=null;s.forEach(((s,l)=>{if(-1!==e.indexOf(parseInt(s.getAttribute("data-id")))){let e=this.dimensional_data[t][l].checked;!0===i?!1===e&&s.click():!1===i&&!0===e&&s.click();let r=this.dimensional_data[t][l].nodes;Array.isArray(r)&&r.forEach((t=>{-1===n.indexOf(r)&&n.push(t)})),null===a&&(a=l)}})),null!==a&&this.STACKS[t].scrollTo(0,27*a),this._checkAll(t+1,n,i)},this._bind=function(){if(setTimeout((()=>{this.selected_label_dom.forEach((t=>{this._triggerEvent.enable=!1,t.click(),this._triggerEvent.enable=!0}))})),this.selectInputDOM instanceof HTMLElement&&(this.selectInputDOM.value=JSON.stringify(this.select_data)),!0===this._useSearchMod){let t=this.DOM.querySelector(".dot-search");t.addEventListener("input",(()=>{setTimeout((()=>{this._search(t)}),500)}))}}):console.error('CascadeDot param select must be object such as [{"key":1,"val":"root-node","nodes":[]},...] !')}useSearch(){return this._useSearchMod=!0,this}trigger(t=function(){}){return this._triggerEvent={func:t,enable:!0},this}selected(t){return Array.isArray(t)?(this.selected_data=t,this):(console.error("CascadeDot param selected must be array!"),this)}limitNum(t){return this.limit=t,this}useHiddenInput(t){return this.DOM.insertAdjacentHTML("beforeend",`<input name="${t}[select]" value="[]" type="hidden" /><input name="${t}[insert]" value="[]" type="hidden" /><input name="${t}[delete]" value="[]" type="hidden" />`),this.selectInputDOM=this.DOM.querySelector(`input[name='${t}[select]']`),this.insertInputDOM=this.DOM.querySelector(`input[name='${t}[insert]']`),this.deleteInputDOM=this.DOM.querySelector(`input[name='${t}[delete]']`),this}make(){let t="";!0===this._useSearchMod&&(t='<input type="text" class="dlp dot-search" placeholder="搜索名称">');let e=`<div class="dlp dlp-dot"><div class="dot-top">${t}<div class="dot-selected dlp-scroll"></div></div><div class="dot-body"><div class="dot-select dot-select-cascade"></div></div></div>`;this.DOM.insertAdjacentHTML("afterbegin",e),this.DOM.addEventListener("contextmenu",(t=>{t.preventDefault()})),this.SELECTED_DOM=this.DOM.querySelector(".dot-selected"),this.CONTENT_DOM=this.DOM.querySelector(".dot-select"),this._makeSelect(this.select),this._bind()}},window.ComponentLine=class{IMG_DELAY_QUEUE=[];IMG_DELAY_SETTINGS={};rowH;InputDOM;InsertRowData={};constructor(t,e,i={sortable:!0,delete:!0,insert:!0,isomer:!1}){t instanceof HTMLElement?this.DOM=t:this.DOM=document.querySelector(t),this.DOM.addEventListener("contextmenu",(t=>{t.preventDefault()})),this.COLUMNS=e,this.OPTIONS=Object.assign({sortable:!0,delete:!0,insert:!0,isomer:!1},i),this._makeHead=function(){let t='<tr class="dlp-tr">',e=this.COLUMNS;for(let i in e){if(!e.hasOwnProperty(i))continue;let s=e[i];(this.InsertRowData[i]="","hidden"!==s.type)&&(t+=`<th class="dlp-text text-white" ${s.width?`style="width:${s.width}"`:""}>${s.name}</th>`)}t+='<th class="operate-column"></th></tr>',this.DOM.insertAdjacentHTML("afterbegin",`<table class="dlp dlp-table" style="height: 100%"><thead class="dlp-thead">${t}</thead></table>`),this.TABLE_DOM=this.DOM.querySelector("table")},this._makeBody=function(){let t=document.createElement("tbody");if(t.setAttribute("sortable-list","sortable-list"),t.className="dlp-tbody dlp-scroll",this.TBODY_DOM=t,this.TABLE_DOM.appendChild(t),Array.isArray(this.DATA))this._loadData();else{_component.loading(this.TBODY_DOM);let t=this;this.DATA=Object.assign({url:"",method:"GET",data:{}},this.DATA),this.DATA.callback=function(e){if(1===e.code)return _component.alert(e.message,3,null,t.TBODY_DOM);_component.loading(t.TBODY_DOM,!1);let i=e.data;t._loadData(i)},_component.request(this.DATA)}},this._loadData=function(){let t=[];this.DATA.forEach(((e,i)=>{t.push(this._loadRow(e,i))})),this._assetsDelayEvent(),this.DATA=t,this.InputDOM instanceof HTMLElement&&(this.InputDOM.value=JSON.stringify(this.DATA))},this._loadRow=function(t,e){let i=document.createElement("tr");i.className="dlp-tr",i.setAttribute("sortable-item","sortable-item"),i.setAttribute("data-index",e.toString());let s={};for(let e in this.COLUMNS){if(!this.COLUMNS.hasOwnProperty(e))continue;let n=this.COLUMNS[e];t.hasOwnProperty(e)||(t[e]="");let a=t[e],l=document.createElement("td");this.rowH&&(l.style.height=this.rowH),this._makeTd(l,e,n,a),s[e]=a,i.appendChild(l)}let n=document.createElement("td");if(n.insertAdjacentHTML("afterbegin","<div></div>"),this._operateButton(n),i.appendChild(n),this.TBODY_DOM.appendChild(i),!1!==this.OPTIONS.isomer)for(let e in t)t.hasOwnProperty(e)&&void 0===s[e]&&(s[e]=t[e]);return s},this._assetsDelayEvent=function(){this.IMG_DELAY_QUEUE.length>0&&(_component.imgDelay(this.IMG_DELAY_QUEUE,this.IMG_DELAY_SETTINGS),this.IMG_DELAY_QUEUE=[])},this._makeFoot=function(){let t=document.createElement("tfoot");if(t.className="dlp-tfoot",!this.OPTIONS.insert)return t.insertAdjacentHTML("afterbegin",'<tr class="dlp-tr"></tr>'),void this.TABLE_DOM.appendChild(t);let e=document.createElement("tr");e.className="dlp-tr";let i=this.COLUMNS;for(let t in i){if(!i.hasOwnProperty(t))continue;let s=i[t];if("hidden"===s.type)continue;let n=document.createElement("td");s.width&&(n.style.width=s.width),this._makeTd(n,t,s,"",!0),e.append(n)}this._insertButton(e),t.append(e),this.TABLE_DOM.appendChild(t)},this._makeTd=function(t,e,i,s,n=!1){let a;i.hasOwnProperty("width")&&(t.style.width=i.width);let l=i.type;switch(!0===n&&(l=i.insert_type?i.insert_type:i.type),l){case"text":default:t.insertAdjacentHTML("afterbegin",`<p style="display: block;" class="dlp text-white dlp-text" title="${s}">${s}</p>`);break;case"input":a=document.createElement("input"),a.className="dlp dlp-input",a.setAttribute("data-column",e),a.value=s,t.appendChild(a),!0===n?this._bindInsertColumnAction("input",a,e):this._bindExchangeColumnAction("input",a,t);break;case"datetime":a=document.createElement("input"),a.setAttribute("class","dlp dlp-input"),a.setAttribute("data-column",e),a.value=s,t.style.position="relative",t.appendChild(a),a.flatpickr(i.config),!0===n?this._bindInsertColumnAction("input",a,e):this._bindExchangeColumnAction("input",a,t);break;case"select":let l=document.createElement("div");t.append(l);let r=Object.assign({placeholder:"未选择",height:"150px",limit:1,useSearch:!1},i.options);!1===Array.isArray(s)&&(s=""===s||null===s?[]:[parseInt(s)]);let d=new ComponentDot(l,i.select).selected(s).limitNum(r.limit).menuMod({placeholder:r.placeholder,height:r.height});r.useSearch&&d.useSearch(),!0===n?d.trigger((t=>{this.InsertRowData[e]=t})):d.trigger((i=>{let s=parseInt(t.parentNode.getAttribute("data-index"));this.DATA[s]&&(this.DATA[s][e]=i,this.InputDOM instanceof HTMLElement&&(this.InputDOM.value=JSON.stringify(this.DATA)))})),d.make();break;case"image":let o=document.createElement("img");o.setAttribute("style","max-width: 100%;max-height: 100%;border-radius: 2px"),i.hasOwnProperty("delay")?(o.setAttribute("data-src",s),this.IMG_DELAY_QUEUE.push(o),i.hasOwnProperty("options")&&0===Object.keys(this.IMG_DELAY_SETTINGS).length&&(this.IMG_DELAY_SETTINGS=i.options)):o.setAttribute("src",s),t.append(o)}},this._bindInsertColumnAction=function(t,e,i){e.addEventListener(t,(()=>{this.InsertRowData[i]=e.value}))},this._bindExchangeColumnAction=function(t,e,i){e.addEventListener(t,(()=>{let t=parseInt(i.parentNode.getAttribute("data-index")),s=e.getAttribute("data-column");this.DATA[t]&&(this.DATA[t][s]=e.value,this.InputDOM instanceof HTMLElement&&(this.InputDOM.value=JSON.stringify(this.DATA)),"function"==typeof this.updateAction&&this.updateAction(this.DATA,t))}))},this._operateButton=function(t){if(this.OPTIONS.sortable){let e=document.createElement("i");e.className="dlp text-white",e.setAttribute("style","cursor: pointer;"),e.setAttribute("sortable-handle","sortable-handle"),e.insertAdjacentHTML("afterbegin",_component.move),t.firstElementChild.appendChild(e)}if(this.OPTIONS.delete){let e=document.createElement("i");e.className="dlp text-white",e.setAttribute("style","cursor: pointer;"),e.insertAdjacentHTML("afterbegin",_component.trash),e.addEventListener("click",(()=>{let t=e.parentNode.parentNode.parentNode,i=t.parentNode,s=parseInt(t.getAttribute("data-index")),n=this.DATA.slice();this.DATA.splice(s,1),i.removeChild(t),this.InputDOM instanceof HTMLElement&&(this.InputDOM.value=JSON.stringify(this.DATA)),this._resetTrSortIndex(),"function"==typeof this.deleteAction&&this.deleteAction(this.DATA,n,s)}),!1),t.firstElementChild.appendChild(e)}t.className="operate-column"},this._insertButton=function(t){let e=document.createElement("i");e.className="dlp text-white",e.style.cursor="pointer",e.insertAdjacentHTML("afterbegin",_component.write),e.addEventListener("click",(()=>{let t=`${this.TBODY_DOM.childNodes.length}`;this._loadRow(this.InsertRowData,t),this.DATA.push(this.InsertRowData),this.InputDOM instanceof HTMLElement&&(this.InputDOM.value=JSON.stringify(this.DATA)),this.TBODY_DOM.scrollTop=this.TBODY_DOM.scrollHeight,"function"==typeof this.insertAction&&this.insertAction(this.DATA,t,this.InsertRowData)}),!1);let i=document.createElement("td");i.className="operate-column";let s=document.createElement("div");s.append(e),i.append(s),t.append(i)},this._sortable=function(){let t=this;new ComponentSortable(this.TBODY_DOM,(function(e){let i=[];e.forEach((function(e){i.push(t.DATA[e])})),t.DATA=i,t.InputDOM.value=JSON.stringify(t.DATA),t._resetTrSortIndex(),"function"==typeof t.sortableAction&&t.sortableAction(t.DATA,e)}))},this._resetTrSortIndex=function(){this.TBODY_DOM.childNodes.forEach(((t,e)=>{t.setAttribute("data-index",e.toString())}))}}load(t){return this.DATA=t,this}setRowHeight(t){return this.rowH=parseInt(t)+"px",this}bindSortableAction(t){return"function"==typeof t&&(this.sortableAction=t),this}bindInsertAction(t){return"function"==typeof t&&(this.insertAction=t),this}bindUpdateAction(t){return"function"==typeof t&&(this.updateAction=t),this}bindDeleteAction(t){return"function"==typeof t&&(this.deleteAction=t),this}useHiddenInput(t){return this.DOM.insertAdjacentHTML("beforeend",`<input type="hidden" name="${t}" value="[]" />`),this.InputDOM=this.DOM.querySelector(`input[name=${t}]`),this}make(){this._makeHead(),this._makeBody(),this._makeFoot(),this.OPTIONS.sortable&&this._sortable()}},window.ComponentPlane=class{WIDTH;HEIGHT;FULLSCREEN;XHR;CONTENT;DELAY_BIND=[];PARENT_DOM=null;XEvent;constructor(t,e={width:.8,height:.8,top:"auto",left:"auto",f:!0,x:!0,gauze:!0,style:{zIndex:"1050",position:"relative"}}){"object"==typeof t&&t.hasOwnProperty("url")?(this.XHR=t,this.XHR=Object.assign({method:"GET",data:{},callback:null},t)):"string"==typeof t||t instanceof HTMLElement?this.CONTENT=t:console.error("type of content error!"),this.OPTIONS=Object.assign({width:.8,height:.8,top:"auto",left:"auto",f:!0,x:!0,gauze:!0,style:{zIndex:"1050",position:"relative"}},e),this.FULLSCREEN=!1,this._calcWindowSize=function(){let t=this.OPTIONS.width,e=this.OPTIONS.height,i=window.innerWidth,s=window.innerHeight;this.PARENT_DOM instanceof HTMLElement&&(i=this.PARENT_DOM.clientWidth,s=this.PARENT_DOM.clientHeight),-1===this.OPTIONS.width.toString().indexOf("px")&&-1===this.OPTIONS.width.toString().indexOf("%")&&(t=i*this.OPTIONS.width,t>=i-18&&(t=i-18),t+="px"),-1===this.OPTIONS.height.toString().indexOf("px")&&-1===this.OPTIONS.height.toString().indexOf("%")&&(e=s*this.OPTIONS.height,e>=s-25&&(e=s-25),e+="px"),"auto"===this.OPTIONS.top&&(this.OPTIONS.top=(s-parseInt(e)-25)/2+"px"),this.WIDTH=t,this.HEIGHT=e},this._appendF=function(){let t=document.createElement("i");t.style.marginRight="10px",t.insertAdjacentHTML("afterbegin",_component.aspect),t.addEventListener("click",(()=>{!1===this.FULLSCREEN?(this.FULLSCREEN=!0,this.DOM.firstChild.style.width="100%",this.DOM.firstChild.style.margin="0",this.DOM.querySelector(".plane-body").style.height=window.innerHeight-25+"px"):(this.FULLSCREEN=!1,this.DOM.firstChild.style.width=this.WIDTH,this.DOM.firstChild.style.marginTop=this.OPTIONS.top,"auto"===this.OPTIONS.left?this.DOM.firstChild.style.margin=`${this.OPTIONS.top} auto`:(this.DOM.firstChild.style.marginTop=this.OPTIONS.top,this.DOM.firstChild.style.marginLeft=this.OPTIONS.left),this.DOM.querySelector(".plane-body").style.height=this.HEIGHT)}),!1),this.DOM.querySelector(".plane-header").append(t)},this._appendX=function(){let t=document.createElement("i");t.insertAdjacentHTML("afterbegin",_component.close),t.style.marginRight="5px",t.addEventListener("click",(()=>{this.DOM instanceof HTMLElement&&this.DOM.remove(),document.getElementById("kvFileinputModal")instanceof HTMLElement&&document.getElementById("kvFileinputModal").remove(),"function"==typeof this.XEvent&&this.XEvent(this)}),!1),this.DOM.querySelector(".plane-header").append(t),window.addEventListener("popstate",(()=>{this.DOM.remove()}),!1)},this._setTitle=function(t){let e=document.createElement("div");e.style.width="100%",t instanceof HTMLElement?e.append(t):e.insertAdjacentHTML("afterbegin",t),this.DOM.querySelector(".plane-header").append(e)},this._xhrContent=function(){_component.loading(this.MODEL_BODY_DOM);let t=this;_component.request({url:this.XHR.url,data:this.XHR.data,method:this.XHR.method,callback:function(e){_component.loading(t.MODEL_BODY_DOM,!0);let i=document.createRange().createContextualFragment(e);t.MODEL_BODY_DOM.appendChild(i),t._delayBind()}})},this._submitEvent=function(t,e){let i=this.DOM.querySelector("form"),s=new FormData(i),n=!1;for(let t of s.entries()){let e,a=t[0],l=t[1];try{e=i.querySelector(`[name="${a}"]`)}catch(t){continue}e.hasAttribute("required")&&""===e.value&&(n=!0,e.focus()),/\[.*\]/.test(a)&&/^\[.*\]$/.test(l)&&"string"==typeof l&&(l=JSON.parse(l),Array.isArray(l)&&l.length>0?l.forEach((t=>{s.append(`${a}[]`,t)})):s.append(`${a}`,""))}if(!n){if("object"==typeof e.data&&0!==Object.keys(e.data).length)for(let t in e.data)e.data.hasOwnProperty(t)&&s.append(t,e.data[t]);t.setAttribute("disabled","disabled"),t.innerText="提交中...",_component.request({url:e.url,method:e.method,data:s,callback:i=>{"function"!=typeof e.callback?i&&(0===i.code?window.location.reload():_component.alert(i.message,3,(function(){t.removeAttribute("disabled"),t.innerText="提交"}))):e.callback(i)}})}},this._delayBind=function(){for(let t of this.DELAY_BIND)try{let e=this.MODEL_BODY_DOM.querySelector(t.selector);if("request"===t.event){e.addEventListener(t.trigger,(()=>this._submitEvent(e,t.params)));continue}e.addEventListener(t.trigger,(()=>t.event(e,t.params)))}catch(e){console.error("cannot find document by selector : "+t.selector)}}}bindRequest(t,e="click",i={url:"",method:"POST",data:{},callback:null}){return i=Object.assign({url:"",method:"POST",data:{},callback:null},i),this.DELAY_BIND.push({selector:t,trigger:e,event:"request",params:i}),this}bindEvent(t,e="click",i=null,s={}){return this.DELAY_BIND.push({selector:t,trigger:e,event:i,params:s}),this}bindXEvent(t=null){return this.XEvent=t,this}setParentDom(t){return t instanceof HTMLElement&&(this.PARENT_DOM=t),this}getDom(){if(this.DOM)return this.DOM}setTitle(t){return this.Title=t,this}make(){this._calcWindowSize();let t=this.OPTIONS.top+" "+this.OPTIONS.left,e=document.createElement("div");e.style.width=this.WIDTH,e.style.margin=t;for(let t in this.OPTIONS.style)this.OPTIONS.style.hasOwnProperty(t)&&(e.style[t]=this.OPTIONS.style[t]);if(e.style.display="grid",e.style.gridTemplateRows=`24px ${this.HEIGHT}`,e.insertAdjacentHTML("afterbegin",'<div class="dlp plane-header"></div><div class="plane-body dlp-scroll"></div>'),this.OPTIONS.gauze){let t=document.createElement("div");t.className="dlp-plane-gauze",t.append(e),this.PARENT_DOM instanceof HTMLElement&&(t.style.position="absolute"),e=t}this.PARENT_DOM instanceof HTMLElement?this.PARENT_DOM.append(e):document.body.append(e),this.DOM=e,this.MODEL_BODY_DOM=this.DOM.querySelector(".plane-body"),this.OPTIONS.background&&(this.MODEL_BODY_DOM.style.background=this.OPTIONS.background),this.Title&&this._setTitle(this.Title),this.OPTIONS.f&&this._appendF(),this.OPTIONS.x&&this._appendX(),this.XHR?this._xhrContent():(this.CONTENT instanceof HTMLElement?this.MODEL_BODY_DOM.append(this.CONTENT):this.MODEL_BODY_DOM.innerHTML=this.CONTENT,this._delayBind())}},window.ComponentSortable=class{constructor(t,e=null){this.list="string"==typeof t?document.querySelector(t):t,this.options={animationSpeed:200,animationEasing:"ease-out"},this.callback=e,this.animation=!1,this.dragStart=this.dragStart.bind(this),this.dragMove=this.dragMove.bind(this),this.dragEnd=this.dragEnd.bind(this),this.list.addEventListener("touchstart",this.dragStart,!1),this.list.addEventListener("mousedown",this.dragStart,!1)}reset(){this.items=Array.from(this.list.children),this.items[this.items.length-1].offsetTop>this.list.offsetHeight?this.listHeight=this.list.scrollHeight:this.listHeight=this.items[this.items.length-1].offsetTop}dragStart(t){if(this.reset(),this.animation)return;if(this.items.length<2)return;this.handle=null;let e=t.target;for(;e&&(e.hasAttribute("sortable-handle")&&(this.handle=e),e.hasAttribute("sortable-item")&&(this.item=e),!e.hasAttribute("sortable-list"));)e=e.parentElement;if(!this.handle)return;this.list.style.position="relative",this.item.classList.add("is-dragging"),this.itemHeight=this.items[1].offsetTop,this.startTouchY=this.getDragY(t),this.startTop=this.item.offsetTop;const i=this.items.map((t=>t.offsetTop));this.items.forEach(((t,e)=>{t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.transform=`translateY(${i[e]}px)`,t.style.zIndex=t===this.item?"2":"1"})),this.positions=this.items.map(((t,e)=>e)),this.position=Math.round(this.startTop/this.listHeight*this.items.length),this.touch="touchstart"===t.type,window.addEventListener(this.touch?"touchmove":"mousemove",this.dragMove),window.addEventListener(this.touch?"touchend":"mouseup",this.dragEnd,!1)}dragMove(t){if(this.animation)return;if(this.items.length<2)return;const e=this.startTop+this.getDragY(t)-this.startTouchY,i=Math.round(e/this.listHeight*this.items.length);this.item.style.transform=`translateY(${e}px)`,this.positions.forEach((t=>{t!==this.position&&t===i&&(this.swapElements(this.positions,this.position,t),this.position=t)})),this.items.forEach(((t,e)=>{t!==this.item&&(t.style.transform=`translateY(${this.positions.indexOf(e)*this.itemHeight}px)`,t.style.transition=`transform ${this.options.animationSpeed}ms ${this.options.animationEasing}`)})),t.preventDefault()}dragEnd(){this.animation=!0,this.items.length<2||(this.item.style.transition=`all ${this.options.animationSpeed}ms ${this.options.animationEasing}`,this.item.style.transform=`translateY(${this.position*this.itemHeight}px)`,this.item.classList.remove("is-dragging"),setTimeout((()=>{this.list.style.position="",this.items.forEach((t=>{t.style.top="",t.style.left="",t.style.right="",t.style.position="",t.style.transform="",t.style.transition="",t.style.zIndex=""})),this.positions.map((t=>{this.items[t]&&this.list.appendChild(this.items[t])})),this.animation=!1,"function"==typeof this.callback&&this.callback(this.positions)}),this.options.animationSpeed),window.removeEventListener(this.touch?"touchmove":"mousemove",this.dragMove),window.removeEventListener(this.touch?"touchend":"mouseup",this.dragEnd,!1))}swapElements(t,e,i){let s=t[e];t[e]=t[i],t[i]=s}getDragY(t){return t.touches?(t.touches[0]||t.changedTouches[0]).pageY:t.pageY}},window.ComponentCascadeLine=class{constructor(t,e,i,s={movable:!0,exchange:!0,detail:!0,insert:!0,update:!0,delete:!0,root:!0}){Array.isArray(e)?(this.select_data=e,this.OPTIONS=Object.assign({movable:!0,exchange:!0,detail:!0,insert:!0,update:!0,delete:!0,root:!0},s),t instanceof HTMLElement?this.DOM=t:this.DOM=document.querySelector(t),this.URL=i,this._makeSelect=function(t){this.dimensional_data=[],_component.dimensional(this.dimensional_data,t);for(let t in this.dimensional_data){if(!this.dimensional_data.hasOwnProperty(t))continue;t=parseInt(t);let e=this.dimensional_data[t],i=document.createElement("div");i.className="dot-cascade-stack dlp-scroll",e.forEach(((e,s)=>{e.stack=t,Array.isArray(e.nodes)&&0!==e.nodes.length?(e.nodes=e.nodes.map((t=>t.key)),e.expand=!1):e.nodes=null;let n=this._insertLabelDom(e,s,t);null!==e.nodes&&n.insertAdjacentHTML("afterbegin",`<i class="left">${_component.caret_right}</i>`),i.append(n)})),this.CONTENT_DOM.append(i)}this.STACKS=this.CONTENT_DOM.childNodes},this._insertLabelDom=function(t,e,i){let s=document.createElement("div");if(s.className="dlp dlp-text dlp-label",s.insertAdjacentHTML("afterbegin",`<span>${t.val}</span>`),s.setAttribute("data-id",t.key.toString()),s.setAttribute("data-k",e.toString()),s.setAttribute("data-stack",i.toString()),s.setAttribute("drag-zone","true"),s.addEventListener("click",(()=>this._select(s,i))),s.addEventListener("contextmenu",(e=>{e.preventDefault(),e.target instanceof HTMLElement&&e.target.click();let n=[];this.OPTIONS.detail&&n.push({title:"详情",func:()=>{this._nodeDetail(s,t)}}),this.OPTIONS.insert&&n.push({title:"新增",func:()=>{this._nodeInsert(s,t,i)}}),this.OPTIONS.update&&n.push({title:"修改",func:()=>{this._nodeUpdate(s,t)}}),this.OPTIONS.delete&&n.push({title:"删除",func:()=>{this._nodeDelete(s,t,i)}}),this.OPTIONS.root&&n.push({title:_component.node,func:()=>{this._nodeRoot(s)}}),_component.contextmenu(e,n)})),this.OPTIONS.movable){let t=document.createElement("i");t.className="right",t.insertAdjacentHTML("afterbegin",_component.move),this._nodeMigrate(t),s.append(t)}return s},this._select=function(t,e){let i=parseInt(t.getAttribute("data-k")),s=this.dimensional_data[e][i],n=this.STACKS[e].childNodes,a=s.parentNodes[s.parentNodes.length-1];if(this.dimensional_data[e].forEach(((t,e)=>{let i=n[e];-1!==t.parentNodes.indexOf(a)?i.classList.remove("dlp-label-silence"):i.classList.add("dlp-label-silence"),this._expand(t,n[e],!1)})),this._expand(s,t,!0),t.classList.remove("dlp-label-silence"),this._selectToChildren(e+1,s.nodes),Array.isArray(s.parentNodes)&&s.parentNodes.length>0){let t=s.parentNodes.slice(0);this._selectToParent(t)}},this._selectToParent=function(t){let e=t.length-1,i=t.pop(),s=t[e-1],n=this.STACKS[e].childNodes,a=null;this.dimensional_data[e].forEach(((t,l)=>{let r=n[l],d=t.parentNodes;d.length>0&&d[e-1]!==s||0===d.length&&parseInt(r.getAttribute("data-id"))!==i?(r.classList.add("dlp-label-silence"),this._expand(t,r,!1)):(r.classList.remove("dlp-label-silence"),parseInt(r.getAttribute("data-id"))===i?(null===a&&(a=l),this._expand(t,r,!0)):this._expand(t,r,!1))})),null!==a&&this.STACKS[e].scrollTo(0,27*a),t.length>0&&this._selectToParent(t)},this._selectToChildren=function(t,e){if(t>this.dimensional_data.length-1)return;let i=this.STACKS[t].childNodes,s=[],n=null;this.dimensional_data[t].forEach(((a,l)=>{let r=i[l];if(null!==e)if(-1!==e.indexOf(parseInt(r.getAttribute("data-id")))){r.classList.remove("dlp-label-silence");let e=this.dimensional_data[t][l].nodes;Array.isArray(e)&&e.forEach((t=>{-1===s.indexOf(e)&&s.push(t)})),null===n&&(n=l),this._expand(a,r,!0)}else r.classList.add("dlp-label-silence"),this._expand(a,r,!1);else r.classList.add("dlp-label-silence")})),null!==n&&this.STACKS[t].scrollTo(0,27*n),this._selectToChildren(t+1,s)},this._expand=function(t,e,i=!0){if(t.expand===i)return;t.expand=i;let s=e.querySelector("i.left");s instanceof HTMLElement&&(s.innerHTML=i?_component.caret_right_circle:_component.caret_right)},this._nodeDetail=function(t,e){let i=`<span class="dlp-text title" title="${e.val}">${e.val}  详情</span>`;this.PLANE_DOM=new ComponentPlane({url:this.URL+"/"+e.key,method:"GET"}).setParentDom(this.DOM).setTitle(i),this.PLANE_DOM.make()},this._nodeInsert=function(t,e,i){let s=`<span class="dlp-text title" title="${e.val}">${e.val}  新增</span>`,n=this,a=parseInt(i)+1;this.PLANE_DOM=new ComponentPlane({url:this.URL+"/create",method:"GET",data:{id:e.key}}).setParentDom(this.DOM).setTitle(s),this.PLANE_DOM.bindRequest('button[type="submit"]',"click",{url:n.URL,method:"POST",data:e,callback:i=>{if(0!==i.code)return _component.alert(i.message,3,null,n.DOM);if(void 0===i.data.key)return _component.alert("返回数据结构缺少key",3,null,n.DOM);if(void 0===i.data.val)return _component.alert("返回数据结构缺少val",3,null,n.DOM);let s=parseInt(i.data.key),l=i.data.val,r=e.parentNodes.slice(0);if(r.push(e.key),Array.isArray(n.dimensional_data[a]))if(Array.isArray(e.nodes)&&0!==e.nodes.length){let t=e.nodes[e.nodes.length-1],i=n.STACKS[a].childNodes,d=0;for(let e in n.dimensional_data[a])if(n.dimensional_data[a].hasOwnProperty(e)&&(e=parseInt(e),d=e+1,n.dimensional_data[a][e].key===t)){n.dimensional_data[a].splice(d,0,{expand:!1,key:s,val:l,nodes:null,parentNodes:r});let t=i[e];t.parentNode.insertBefore(n._insertLabelDom(n.dimensional_data[a][d],d,a),t.nextSibling);break}n.dimensional_data[a].forEach(((t,e)=>{e>d&&i[e].setAttribute("data-k",e)})),n.STACKS[a].scrollTo(0,27*d)}else{let e=n.dimensional_data[a].push({expand:!1,key:s,val:l,nodes:null,parentNodes:r})-1;n.STACKS[a].append(n._insertLabelDom(n.dimensional_data[a][e],e,a)),t.insertAdjacentHTML("afterbegin",`<i class="left">${_component.caret_right_circle}</i>`),n.STACKS[a].scrollTo(0,27*e)}else{n.dimensional_data[a]=[{expand:!1,key:s,val:l,nodes:null,parentNodes:r}];let e=document.createElement("div");e.className="dot-cascade-stack dlp-scroll",e.append(n._insertLabelDom(n.dimensional_data[a][0],0,a)),n.CONTENT_DOM.append(e),t.insertAdjacentHTML("afterbegin",`<i class="left">${_component.caret_right_circle}</i>`)}Array.isArray(e.nodes)||(e.nodes=[]),e.nodes.push(s),n.PLANE_DOM.getDom().remove()}}).make()},this._nodeUpdate=function(t,e){let i=`<span class="dlp-text title" title="${e.val}">${e.val}  修改</span>`,s=this;this.PLANE_DOM=new ComponentPlane({url:this.URL+"/"+e.key+"/edit",method:"GET",data:e}).setParentDom(this.DOM).setTitle(i),this.PLANE_DOM.bindRequest('button[type="submit"]',"click",{url:s.URL+"/"+e.key,method:"POST",data:e,callback:function(i){if(0!==i.code)return _component.alert(i.message,3,null,s.DOM);if(void 0===i.data.val)return _component.alert("返回数据结构缺少val",3,null,s.DOM);let n=i.data.val;e.val=n,t.querySelector("span").textContent=n,s.PLANE_DOM.getDom().remove()}}).make()},this._nodeDelete=function(t,e,i){let s=this,n=`<p class="dlp-text title" title="${e.val}">${e.val}   删除</p>`,a=document.createElement("div");a.style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;";let l=document.createElement("div");l.className="dlp dlp-button",l.style.width="85%",l.addEventListener("click",(()=>{s.submit_block||(s.submit_block=!0,l.querySelector(".right").innerHTML=_component.sub_loading,_component.request({url:this.URL+"/"+e.key,method:"DELETE",callback:function(t){if(s.submit_block=!1,0!==t.code)return _component.alert(t.message,3,null,s.DOM);s._nodeDeleteExec(e,i),s.PLANE_DOM.getDom().remove()}}))})),l.insertAdjacentHTML("afterbegin",`<p style="width: 100%;text-align: center">${e.val}</p> <i class="right">${_component.trash}</i>`),a.append(l),this.PLANE_DOM=new ComponentPlane(a,{width:"300px",height:"65px",f:!1}).setParentDom(this.DOM).setTitle(n),this.PLANE_DOM.make()},this._nodeDeleteExec=function(t,e){let i,s=t.parentNodes.length-1;if(s>=0){let e=t.parentNodes.pop();for(let i in this.dimensional_data[s]){if(!this.dimensional_data[s].hasOwnProperty(i))continue;i=parseInt(i);let n=this.dimensional_data[s][i];if(n.key===e&&(n.nodes.forEach(((e,i)=>{e===t.key&&n.nodes.splice(i,1)})),0===n.nodes.length)){let t=this.STACKS[s].childNodes[i].querySelector("i.left");t&&t.remove()}}}for(let i=e+1;i<this.dimensional_data.length;i++){let e=[],s=[],n=0;for(let a in this.dimensional_data[i]){if(!this.dimensional_data[i].hasOwnProperty(a))continue;a=parseInt(a);let l=this.dimensional_data[i][a];-1===l.parentNodes.indexOf(t.key)?(this.STACKS[i].childNodes[a].setAttribute("data-k",n),n++,e.push(l)):s.push(this.STACKS[i].childNodes[a])}for(let t of s)t.remove();if(0===e.length){this.dimensional_data.splice(i,1),this.STACKS[i].remove();break}this.dimensional_data[i]=e}let n=!1,a=0;for(let s of this.STACKS[e].childNodes)parseInt(s.getAttribute("data-id"))!==t.key?(n&&s.setAttribute("data-k",a),a++):(n=!0,this.dimensional_data[e].splice(a,1),i=s);i.remove(),0===this.STACKS[e].childNodes.length&&(e>0?(this.STACKS[e].remove(),this.dimensional_data.splice(e,1)):this.dimensional_data=[[]])},this._nodeRoot=function(t){let e=parseInt(t.getAttribute("data-stack")),i=parseInt(t.getAttribute("data-k")),s=this.dimensional_data[e][i],n=`<span class="dlp-text title" title="${s.val}">${s.val} 迁移到根</span>`,a=document.createElement("div");a.style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;flex-direction: column;";let l=document.createElement("div");l.className="dlp dlp-button",l.style.width="85%",l.insertAdjacentHTML("afterbegin",`<p style="width: 100%;text-align: center">${s.val}</p><i class="right">${_component.check_circle}</i>`),a.insertAdjacentHTML("afterbegin",`<div class="dlp" style="display: flex">${_component.node}</div>`),a.insertAdjacentHTML("beforeend",'<div style="font-size: 16px!important;font-family: cursive;font-weight: bolder;">↑</div>');let r=this;a.append(l),this.PLANE_DOM=new ComponentPlane(a,{width:"300px",height:"95px"}).setParentDom(this.DOM).setTitle(n).bindEvent("div.dlp-button","click",(()=>{if(0===s.stack)return r.PLANE_DOM.remove();r.submit_block||(r.submit_block=!0,l.querySelector(".right").innerHTML=_component.sub_loading,_component.request({url:this.URL,method:"GET",data:{event:"root",node_key:s.key,node_val:s.val},callback:function(e){if(r.submit_block=!1,0!==(e=JSON.parse(e)).code)return _component.alert(e.message,3,null,r.DOM);r._nodeRootExec(t,s),r.PLANE_DOM.getDom().remove()},error_callback:function(){r.submit_block=!1,r.PLANE_DOM.getDom().remove()}}))})),this.PLANE_DOM.make()},this._nodeRootExec=function(t,e){let i=e.parentNodes.slice().pop(),s=e.stack-1;e.parentNodes=[];let n=0-e.stack,a=parseInt(t.getAttribute("data-k"));this.dimensional_data[e.stack].splice(a,1),this.dimensional_data[0].push(e),null!==e.nodes&&this._resetChildrenDimensional(e,e.stack+1,n),e.stack=0,this.dimensional_data=this.dimensional_data.filter((t=>t.length>0)),this.CONTENT_DOM.innerHTML="";for(let t in this.dimensional_data){if(!this.dimensional_data.hasOwnProperty(t))continue;t=parseInt(t);let n=this.dimensional_data[t],a=document.createElement("div");a.className="dot-cascade-stack dlp-scroll",n.forEach(((n,l)=>{parseInt(t)===s&&n.key===i&&n.nodes.splice(n.nodes.indexOf(e.key),1),Array.isArray(n.nodes)&&0!==n.nodes.length?n.expand=!1:n.nodes=null;let r=this._insertLabelDom(n,l,t);null!==n.nodes&&r.insertAdjacentHTML("afterbegin",`<i class="left">${_component.caret_right}</i>`),a.append(r)})),this.CONTENT_DOM.append(a)}},this._rootNodeInsert=function(){let t=document.createElement("div");t.className="dlp-btn",t.addEventListener("click",(()=>{let t=this;this.PLANE_DOM=new ComponentPlane({url:this.URL+"/create",method:"GET"}).setParentDom(this.DOM).setTitle('<span class="dlp-text title">根添加</span>'),this.PLANE_DOM.bindRequest('button[type="submit"]',"click",{url:t.URL,method:"POST",data:{key:0},callback:e=>{if(void 0===e.data.key)return _component.alert("返回数据结构缺少key",3,null,t.DOM);if(void 0===e.data.val)return _component.alert("返回数据结构缺少val",3,null,t.DOM);let i=parseInt(e.data.key),s=e.data.val,n=t.dimensional_data[0].push({expand:!1,key:i,val:s,stack:0,nodes:null,parentNodes:[]})-1,a=t.STACKS[0];a.append(t._insertLabelDom(t.dimensional_data[0][n],n,0)),t.STACKS[0].scrollTo(0,27*n),a.lastChild.click(),t.PLANE_DOM.getDom().remove()}}).make()})),t.insertAdjacentHTML("afterbegin",_component.node),this.HEADER_DOM.append(t)},this._nodeMigrate=function(t){let e=this,i=null;function s(t){t.preventDefault();let s=t.target;for(;null!==s&&(s instanceof HTMLElement||"svg"===s.tagName)&&"true"!==s.getAttribute("drag-area")&&"BODY"!==s.tagName;){if("true"===s.getAttribute("drag-zone")){if("dragover"===t.type)if(i=s,i.classList.contains("dlp-label-silence")&&i.click(),e.OPTIONS.exchange)i.style.setProperty("background","#bb8f2c");else{let t=parseInt(i.getAttribute("data-stack")),n=parseInt(i.getAttribute("data-k")),a=e.dimensional_data[t][n].parentNodes;Array.isArray(a)&&-1===a.indexOf(parseInt(s.getAttribute("data-id")))&&i.style.setProperty("background","#bb8f2c")}else"dragleave"===t.type&&i instanceof HTMLElement&&(i.style.removeProperty("background"),i=null);break}s=s.parentNode}}function n(t){t.target.removeAttribute("draggable"),t.target.style.removeProperty("border"),t.target.removeEventListener("dragend",n),document.removeEventListener("dragover",s),document.removeEventListener("dragleave",s),i instanceof HTMLElement&&e._nodeMigrateDialog(t.target,i)}t.addEventListener("mousedown",(()=>{t.parentNode.click(),t.parentNode.setAttribute("draggable","true"),t.parentNode.style.setProperty("border","1px dashed #3c2d2d"),document.addEventListener("dragover",s),document.addEventListener("dragleave",s),t.parentNode.addEventListener("dragend",n)})),t.addEventListener("mouseup",(()=>{t.parentNode.style.removeProperty("border"),document.removeEventListener("dragover",s),document.removeEventListener("dragleave",s),t.parentNode.removeEventListener("dragend",n),i instanceof HTMLElement&&(i.style.removeProperty("background"),i=null)}))},this._nodeMigrateDialog=function(t,e){let i,s=parseInt(e.getAttribute("data-stack")),n=parseInt(e.getAttribute("data-k")),a=this.dimensional_data[s][n];s=parseInt(t.getAttribute("data-stack")),n=parseInt(t.getAttribute("data-k"));let l=this.dimensional_data[s][n],r="迁移";if(-1!==a.parentNodes.indexOf(l.key)?(i="exchange",r="交换"):i="migrate",!this.OPTIONS.exchange&&"exchange"===i)return;e.style.removeProperty("background"),r=`<p class="dlp-text title" title="${l.val}">${l.val} ${r}</p>`;let d=document.createElement("div");d.style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;flex-direction: column;";let o=document.createElement("div"),h=this;o.className="dlp dlp-button",o.style.width="85%",o.insertAdjacentHTML("afterbegin",`<p style="width: 100%;text-align: center">${l.val}</p><i class="right">${_component.check_circle}</i>`),d.insertAdjacentHTML("afterbegin",`<div class="dlp dlp-text dlp-label"><span>${a.val}</span></div>`),"exchange"===i?d.insertAdjacentHTML("beforeend",'<div style="font-size: 16px!important;font-family: cursive;font-weight: bolder;">⇵</div>'):d.insertAdjacentHTML("beforeend",'<div style="font-size: 16px!important;font-family: cursive;font-weight: bolder;">↑</div>'),d.append(o),this.PLANE_DOM=new ComponentPlane(d,{width:"300px",height:"95px",f:!1}).bindEvent("div.dlp-button","click",(()=>{h.submit_block||(h.submit_block=!0,o.querySelector(".right").innerHTML=_component.sub_loading,_component.request({url:this.URL,method:"GET",data:{event:i,node_key:l.key,node_val:l.val,aim_node_key:a.key,aim_node_val:a.val},callback:function(s){if(h.submit_block=!1,0!==(s=JSON.parse(s)).code)return _component.alert(s.message,3,null,h.DOM);"exchange"===i&&h._nodeExchangeExec(t,l,e,a),"migrate"===i&&h._nodeMigrateExec(t,l,e,a),h.PLANE_DOM.getDom().remove()},error_callback:function(){h.submit_block=!1}}))})).setParentDom(this.DOM).setTitle(r),this.PLANE_DOM.make()},this._nodeMigrateExec=function(t,e,i,s){let n,a=e.parentNodes.slice().pop(),l=e.stack-1,r=s.parentNodes.slice(0);r.push(s.key),e.parentNodes=r,null!==s.nodes&&(n=s.nodes.slice(0).pop());let d=s.stack+1,o=d-e.stack,h=parseInt(t.getAttribute("data-k"));if(this.dimensional_data[e.stack].splice(h,1),Array.isArray(this.dimensional_data[d])||(this.dimensional_data[d]=[]),n){let t=0;for(let e in this.dimensional_data[s.stack+1])if(this.dimensional_data[s.stack+1].hasOwnProperty(e)&&this.dimensional_data[s.stack+1][e].key===n){t=e;break}t++,this.dimensional_data[s.stack+1].splice(t,0,e)}else this.dimensional_data[d].push(e);this._resetChildrenDimensional(e,e.stack+1,o),this.dimensional_data=this.dimensional_data.filter((t=>t.length>0)),e.stack=d,Array.isArray(s.nodes)||(s.nodes=[]),s.nodes.push(e.key),this.CONTENT_DOM.innerHTML="";for(let t in this.dimensional_data){if(!this.dimensional_data.hasOwnProperty(t))continue;t=parseInt(t);let i=this.dimensional_data[t],s=document.createElement("div");s.className="dot-cascade-stack dlp-scroll",i.forEach(((i,n)=>{parseInt(t)===l&&i.key===a&&i.nodes.splice(i.nodes.indexOf(e.key),1),Array.isArray(i.nodes)&&0!==i.nodes.length?i.expand=!1:i.nodes=null;let r=this._insertLabelDom(i,n,t);null!==i.nodes&&r.insertAdjacentHTML("afterbegin",`<i class="left">${_component.caret_right}</i>`),s.append(r)})),this.CONTENT_DOM.append(s)}},this._nodeExchangeExec=function(t,e,i,s){let n=e.key,a=e.val;e.key=s.key,e.val=s.val;let l=e.nodes.indexOf(s.key);-1!==l&&e.nodes.splice(l,1,n);let r=e.parentNodes.slice(0).pop();if(void 0!==r)for(let t in this.dimensional_data[e.stack-1]){if(!this.dimensional_data[e.stack-1].hasOwnProperty(t))continue;let i=this.dimensional_data[e.stack-1][t];if(i.key===r){i.nodes.splice(i.nodes.indexOf(n),1,s.key);break}}s.key=n,s.val=a;let d=s.parentNodes.slice(0).pop();for(let t in this.dimensional_data[s.stack-1]){if(!this.dimensional_data[s.stack-1].hasOwnProperty(t))continue;let i=this.dimensional_data[s.stack-1][t];if(i.key===d){i.nodes.splice(i.nodes.indexOf(e.key),1,s.key);break}}this._resetChildrenParent(e),t.querySelector("span").textContent=e.val,t.setAttribute("data-id",e.key),i.querySelector("span").textContent=s.val,i.setAttribute("data-id",s.key)},this._resetChildrenDimensional=function(t,e,i){let s=t.nodes,n=t.parentNodes.slice(0);if(n.push(t.key),!Array.isArray(this.dimensional_data[e]))return;let a=[];this.dimensional_data[e].forEach(((t,l)=>{Array.isArray(s)&&-1!==s.indexOf(t.key)&&(a.push(l),t.parentNodes=n,t.stack=e+i,Array.isArray(this.dimensional_data[t.stack])||(this.dimensional_data[t.stack]=[]),this.dimensional_data[t.stack].push(t),this._resetChildrenDimensional(t,e+1,i))})),a.reverse(),a.forEach((t=>{this.dimensional_data[e].splice(t,1)}))},this._search=function(t){if(Array.isArray(this.search_result)&&this.search_result.length>0){let t=this.search_result[this.search_result_pick-1];this.STACKS[t.stack].childNodes[t.index].classList.remove("dlp-label-active")}if(this.search_result=[],this.search_result_panel instanceof HTMLElement&&this.search_result_panel.remove(),""===t.value)return;if(this.dimensional_data.forEach(((e,i)=>{e.forEach(((e,s)=>{-1===e.val.indexOf(t.value)&&-1===t.value.indexOf(e.val)||this.search_result.push({stack:i,index:s})}))})),0===this.search_result.length)return;let e=document.createElement("div");e.className="dot-search-result-panel";let i=document.createElement("span");i.className="dlp-btn",i.textContent="◀",i.addEventListener("click",(()=>this._searchPick(!1)));let s=document.createElement("span");s.className="dlp-btn",s.textContent="▶",s.addEventListener("click",(()=>this._searchPick(!0)));let n=document.createElement("span");n.className="search-result-number dlp-text",n.textContent="1",this.SEARCH_PICK=n,this.search_result_pick=1,e.append(i),e.append(n),e.insertAdjacentHTML("beforeend",`<span> / </span><span class="search-result-number dlp-text">${this.search_result.length.toString()}</span>`),e.append(s),this.search_result_panel=e,this.SEARCH_BOX.append(e),this._pickUp()},this._searchPick=function(t=!0){let e=this.search_result[this.search_result_pick-1];this.STACKS[e.stack].childNodes[e.index].classList.remove("dlp-label-active"),t?(this.search_result_pick++,this.search_result_pick>this.search_result.length&&(this.search_result_pick=1)):(this.search_result_pick--,this.search_result_pick<1&&(this.search_result_pick=this.search_result.length)),this.SEARCH_PICK.textContent=this.search_result_pick.toString(),this._pickUp()},this._pickUp=function(){let t=this.search_result[this.search_result_pick-1],e=this.STACKS[t.stack].childNodes[t.index];e instanceof HTMLElement&&(e.classList.add("dlp-label-active"),this.STACKS[t.stack].scrollTo(0,27*t.index),e.click())}):console.error("CascadeLine param select must be array!")}make(){this.DOM.insertAdjacentHTML("afterbegin",'<div class="dlp dlp-dot dlp-cascadeLine"><div class="dot-top"><div class="search-box"><input type="text" class="dlp dot-search" placeholder="搜索名称"></div></div><div class="dot-body"><div class="dot-select dot-select-cascade" drag-area="true"></div></div></div>'),this.DOM.addEventListener("contextmenu",(t=>{t.preventDefault()})),this.DOM.style.position="relative",this.HEADER_DOM=this.DOM.querySelector(".dot-top"),this.CONTENT_DOM=this.DOM.querySelector(".dot-select"),this.SEARCH_BOX=this.DOM.querySelector(".search-box"),this._makeSelect(this.select_data),this.OPTIONS.root&&this._rootNodeInsert();let t=this.DOM.querySelector(".dot-search");t.addEventListener("input",(()=>{setTimeout((()=>{this._search(t)}),700)}))}};